/*
 * MindTouch Deki - enterprise collaboration and integration platform
 * Copyright (C) 2006-2009 MindTouch, Inc.
 * www.mindtouch.com  oss@mindtouch.com
 *
 * For community documentation and downloads visit www.opengarden.org;
 * please review the licensing section.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along
 * with this program; if not, write to the Free Software Foundation, Inc.,
 * 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
 * http://www.gnu.org/copyleft/gpl.html
 */

(function(){(function(){var a=null,b=null,c,d=0;function e(h){var i=h.getCommand('maximize');if(h.document&&(!i||i.state!=1)){var j=h.getThemeSpace('contents'),k=j.getStyle('height'),l;if(CKEDITOR.env.ie||CKEDITOR.env.gecko)l=h.document.getBody().$.scrollHeight+(CKEDITOR.env.ie&&CKEDITOR.env.quirks?0:24);else l=Deki.$(h.document.getBody().$).innerHeight();k=parseInt(k)||Deki.$(j.$).height();var m=l||h.config.height;if(m<h.config.resize_minHeight)m=h.config.resize_minHeight;var n=m-k;if(n!=0){m=h.fire('autoGrow',{currentHeight:k,newHeight:m}).newHeight;h.resize(null,m+70,true);}}};function f(h){var i=h.textarea,j=h.getCommand('maximize');if(!i||j&&j.state==1)return;var k;if(CKEDITOR.env.ie)k=i.$.scrollHeight;else{var l=i.getComputedStyle('padding-left'),m=i.getComputedStyle('padding-right');if(b===null){b=CKEDITOR.document.createElement('pre');b.setStyles({'font-size':i.getComputedStyle('font-size'),'font-family':i.getComputedStyle('font-family'),'padding-top':i.getComputedStyle('padding-top'),'padding-right':m,'padding-bottom':i.getComputedStyle('padding-bottom'),'padding-left':l,'line-height':i.getComputedStyle('line-height'),'letter-spacing':i.getComputedStyle('letter-spacing'),'overflow-x':'hidden',position:'absolute',top:0,left:'-9999px','white-space':'pre-wrap'});b.appendTo(i.getDocument().getBody());var n=parseInt(l)+parseInt(m);n=n||0;b.setStyle('width',i.$.clientWidth-n+'px');}var o=i.getValue().replace(/(<|>)/g,'_');o=o.replace(/&/g,'&amp;');var p=new CKEDITOR.dom.element('div',h.document);p.setHtml(o);if(b.getHtml()!=p.getHtml()){b.setHtml(o);var q=Deki.$(i.$).height(),r=Deki.$(b.$).height(),s=i.getComputedStyle('line-height');s=parseInt(s)||0;if(q<r+s||r<q)k=r+s;}}if(!isNaN(k)){k+=50;if(k<h.config.resize_minHeight)k=h.config.resize_minHeight;if(k!=d){if(CKEDITOR.env.ie)i.setStyle('height',k+'px');k=h.fire('autoGrow',{currentHeight:q,newHeight:k}).newHeight;h.resize(null,k,true);d=k;}}};function g(h){var i=h.editor,j=CKEDITOR.document.getWindow();switch(i.mode){case 'wysiwyg':if(a){window.clearInterval(a);a=null;}if(b){b.remove();b=null;}if(typeof c=='function'){i.removeListener('resize',c);j.removeListener('resize',c);}d=0;var k={contentDom:null,key:null,selectionChange:null,insertElement:200,insertHtml:200,paste:2000};for(var l in k){var m=k[l];i.on(l,function(o){setTimeout(function(){e(o.editor);},100);},null,null,m);}break;case 'source':if(i.config.autogrow_source){if(CKEDITOR.env.ie){var n=i.textarea;c=function(o){var p=n&&n.getParent();p&&n.setStyle('height',p.$.clientHeight+'px');
o.cancel();};i.on('resize',c,null,null,1);j.on('resize',c,null,null,1);}f(i);a=window.setInterval(function(){f(i);},400);}break;}};CKEDITOR.plugins.add('autogrow',{requires:['floatingtoolbar'],init:function(h){if(h.config.autogrow){h.on('mode',g);h.on('contentDom',g);}}});})();CKEDITOR.config.autogrow=true;CKEDITOR.config.autogrow_source=true;(function(){CKEDITOR.plugins.add('ckoverrides',{beforeInit:function(a){CKEDITOR.tools.extend(CKEDITOR.dom.node.prototype,{clone:function(b,c){var d=this.$.cloneNode(b),e=function(f){if(f.nodeType!=1)return;if(!c)f.removeAttribute('id',false);f.removeAttribute('data-cke-expando',false);f.removeAttribute('function',false);f.removeAttribute('block',false);f.removeAttribute('init',false);f.removeAttribute('foreach',false);f.removeAttribute('if',false);f.removeAttribute('where',false);f.removeAttribute('ctor',false);if(b){var g=f.childNodes;for(var h=0;h<g.length;h++)e(g[h]);}};e(d);return new CKEDITOR.dom.node(d);}},true);},init:function(a){}});})();CKEDITOR.plugins.add('combobutton',{requires:['richcombo'],onLoad:function(){CKEDITOR.ui.comboButton=CKEDITOR.tools.createClass({base:CKEDITOR.ui.richCombo,$:function(a){this.base(a);},statics:{handler:{create:function(a){return new CKEDITOR.ui.comboButton(a);}}},proto:{canGroup:true,onClose:function(){this.setState(this._.previousState);},render:function(a,b){var c=CKEDITOR.env,d='cke_'+this.id,e=CKEDITOR.tools.addFunction(function(j){var m=this;var k=m._;if(k.state==0)return;if(!k.on)k.previousState=k.state;m.createPanel(a);if(k.on){k.panel.hide();return;}m.commit();var l=m.getValue();if(l)k.list.mark(l);else k.list.unmarkAll();k.panel.showBlock(m.id,new CKEDITOR.dom.element(j),4);},this),f={id:d,combo:this,focus:function(){var j=CKEDITOR.document.getById(d);j.focus();},clickFn:e};a.on('mode',function(){this.setState(this.modes[a.mode]?2:0);this.setValue('');},this);var g=CKEDITOR.tools.addFunction(function(j,k){j=new CKEDITOR.dom.event(j);var l=j.getKeystroke();switch(l){case 13:case 32:case 40:CKEDITOR.tools.callFunction(e,k);break;default:f.onkey(f,l);}j.preventDefault();});f.keyDownFn=g;var h='';if(this.className)h+=this.className;h+=' cke_off';b.push('<span class="cke_button'+(this.icon&&this.icon.indexOf('.png')==-1?' cke_noalphafix':'')+'">','<a id="',d,'" class="',h,'"',c.gecko&&c.version>=10900&&!c.hc?'':'" href="javascript:void(\''+(this.title||'').replace("'",'')+"')\"",' title="',this.title,'" tabindex="-1" hidefocus="true" role="button" aria-labelledby="'+d+'_label"'+' aria-haspopup="true"');
if(c.opera||c.gecko&&c.mac)b.push(' onkeypress="return false;"');if(c.gecko)b.push(' onblur="this.style.cssText = this.style.cssText;"');b.push(' onkeydown="CKEDITOR.tools.callFunction( ',g,', event, this );" onclick="CKEDITOR.tools.callFunction(',e,', this); return false;"><span class="cke_icon"');if(this.icon){var i=(this.iconOffset||0)*-16;b.push(' style="background-image:url(',CKEDITOR.getUrl(this.icon),');background-position:0 '+i+'px;"');}b.push('>&nbsp;</span><span id="',d,'_label" class="cke_label">',this.label,'</span>');b.push('<span class="cke_buttonarrow">'+(CKEDITOR.env.hc?'&#9660;':'&nbsp;')+'</span>');b.push('</a>','</span>');if(this.onRender)this.onRender();return f;},setValue:function(a,b){this._.value=a;}}});},init:function(a){a.ui.addHandler(CKEDITOR.UI_COMBOBUTTON,CKEDITOR.ui.comboButton.handler);}});CKEDITOR.UI_COMBOBUTTON=92;CKEDITOR.ui.prototype.addComboButton=function(a,b){this.add(a,CKEDITOR.UI_COMBOBUTTON,b);};(function(){var a={dl:1},b=CKEDITOR.dom.walker.whitespaces(),c=CKEDITOR.dom.walker.bookmark(),d=function(m){return!(b(m)||c(m));};function e(m,n,o,p,q){if(!a[m.getName()])return[];if(!p)p=0;if(!o)o=[];for(var r=0,s=m.getChildCount();r<s;r++){var t=m.getChild(r);if(!t.is||!t.is('dt','dd'))continue;var u={parent:m,indent:p,contents:[],dx:t.getName()};if(!q){u.grandparent=m.getParent();if(u.grandparent&&u.grandparent.is&&u.grandparent.is('dt','dd'))u.grandparent=u.grandparent.getParent();}else u.grandparent=q;if(n)CKEDITOR.dom.element.setMarker(n,t,'listarray_index',o.length);o.push(u);for(var v=0,w=t.getChildCount(),x;v<w;v++){x=t.getChild(v);if(x.type==1&&a[x.getName()])e(x,n,o,p+1,u.grandparent);else u.contents.push(x);}}return o;};function f(m,n,o,p,q){if(!o)o=0;if(!m||m.length<o+1)return null;var r=m[o].parent.getDocument(),s=new CKEDITOR.dom.documentFragment(r),t=null,u=o,v=Math.max(m[o].indent,0),w=null,x=p==1?'p':'div';while(1){var y=m[u];if(y.indent==v){if(!t||m[u].parent.getName()!=t.getName()){t=m[u].parent.clone(0,1);q&&t.setAttribute('dir',q);s.append(t);}w=t.append(r.createElement(y.dx));for(var z=0;z<y.contents.length;z++)w.append(y.contents[z].clone(1,1));u++;}else if(y.indent==Math.max(v,0)+1){var A=f(m,null,u,p);if(!w.getChildCount()&&CKEDITOR.env.ie&&!(r.$.documentMode>7))w.append(r.createText('\xa0'));w.append(A.listNode);u=A.nextIndex;}else if(y.indent==-1&&!o&&y.grandparent){w;if(a[y.grandparent.getName()])w=r.createElement(y.dx);else if(q||y.element.hasAttributes()||p!=2){w=r.createElement(x);y.element.copyAttributes(w,{type:1,value:1});
var B=y.element.getDirection()||q;B&&w.setAttribute('dir',B);if(!q&&p==2&&!w.hasAttributes())w=new CKEDITOR.dom.documentFragment(r);}else w=new CKEDITOR.dom.documentFragment(r);for(z=0;z<y.contents.length;z++)w.append(y.contents[z].clone(1,1));if(w.type==11&&u!=m.length-1){var C=w.getLast();if(C&&C.type==1&&C.getAttribute('type')=='_moz')C.remove();if(!(C=w.getLast(d)&&C.type==1&&C.getName() in CKEDITOR.dtd.$block))w.append(r.createElement('br'));}if(w.type==1&&w.getName()==x&&w.$.firstChild){w.trim();var D=w.getFirst();if(D.type==1&&D.isBlockBoundary()){var E=new CKEDITOR.dom.documentFragment(r);w.moveChildren(E);w=E;}}var F=w.$.nodeName.toLowerCase();if(!CKEDITOR.env.ie&&(F=='div'||F=='p'))w.appendBogus();s.append(w);t=null;u++;}else return null;if(m.length<=u||Math.max(m[u].indent,0)<v)break;}if(n){var G=s.getFirst();while(G){if(G.type==1)CKEDITOR.dom.element.clearMarkers(n,G);G=G.getNextSourceNode();}}return{listNode:s,nextIndex:u};};function g(m){var n=m.data.path,o=n.blockLimit,p=n.elements,q,r;for(r=0;r<p.length&&(q=p[r])&&!q.equals(o);r++){if(a[p[r].getName()])return this.setState(this.type==p[r].getName()?1:2);}return this.setState(2);};function h(m,n,o,p){var q=CKEDITOR.plugins.list.listToArray(n.root,o),r=[];for(var s=0;s<n.contents.length;s++){var t=n.contents[s];t.renameNode(this.type);}};var i=/^h[1-6]$/;function j(m,n,o){var p=n.contents,q=n.root.getDocument(),r=[];if(p.length==1&&p[0].equals(n.root)){var s=q.createElement('div');p[0].moveChildren&&p[0].moveChildren(s);p[0].append(s);p[0]=s;}var t=n.contents[0].getParent();for(var u=0;u<p.length;u++)t=t.getCommonAncestor(p[u].getParent());var v=m.config.useComputedState,w,x;v=v===undefined||v;for(u=0;u<p.length;u++){var y=p[u],z;while(z=y.getParent()){if(z.equals(t)){r.push(y);if(!x&&y.getDirection())x=1;var A=y.getDirection(v);if(w!==null)if(w&&w!=A)w=null;else w=A;break;}y=z;}}if(r.length<1)return;var B=r[r.length-1].getNext(),C=q.createElement('dl');o.push(C);var D,E;while(r.length){D=r.shift();E=q.createElement(this.type=='dl'?'dt':this.type);if(D.is('pre')||i.test(D.getName()))D.appendTo(E);else{if(w&&D.getDirection()){D.removeStyle('direction');D.removeAttribute('dir');}D.copyAttributes(E);D.moveChildren(E);D.remove();}E.appendTo(C);}if(w&&x)C.setAttribute('dir',w);if(B)C.insertBefore(B);else C.appendTo(t);};function k(m,n,o){var p=e(n.root,o),q=[];if(a[this.type])for(var r=0;r<p.length;r++)p[r].indent=-1;else{for(var s=0;s<n.contents.length;s++){var t=n.contents[s];t=t.getAscendant(this.type,true);
if(!t||t.getCustomData('list_item_processed'))continue;q.push(t);CKEDITOR.dom.element.setMarker(o,t,'list_item_processed',true);}var u=null;for(s=0;s<q.length;s++){var v=q[s].getCustomData('listarray_index');p[v].indent=-1;u=v;}for(s=u+1;s<p.length;s++){if(p[s].indent>p[s-1].indent+1){var w=p[s-1].indent+1-p[s].indent,x=p[s].indent;while(p[s]&&p[s].indent>=x){p[s].indent+=w;s++;}s--;}}}var y=f(p,o,null,m.config.enterMode,n.root.getAttribute('dir')),z=y.listNode,A,B;function C(D){if((A=z[D?'getFirst':'getLast']())&&!(A.is&&A.isBlockBoundary())&&(B=n.root[D?'getPrevious':'getNext'](CKEDITOR.dom.walker.whitespaces(true)))&&!(B.is&&B.isBlockBoundary({br:1})))m.document.createElement('br')[D?'insertBefore':'insertAfter'](A);};C(true);C();z.replace(n.root);};function l(m,n){this.name=m;this.type=n;};l.prototype={exec:function(m){m.focus();var n=m.document,o=m.getSelection(),p=o&&o.getRanges(true);if(!p||p.length<1)return;if(this.state==2){var q=n.getBody();q.trim();if(!q.getFirst()){var r=n.createElement(m.config.enterMode==1?'p':m.config.enterMode==3?'div':'br');r.appendTo(q);p=new CKEDITOR.dom.rangeList([new CKEDITOR.dom.range(n)]);if(r.is('br')){p[0].setStartBefore(r);p[0].setEndAfter(r);}else p[0].selectNodeContents(r);o.selectRanges(p);}else{var s=p.length==1&&p[0],t=s&&s.getEnclosedNode();if(t&&t.is&&this.type==t.getName())this.setState(1);}}var u=o.createBookmarks(true),v=[],w={},x=p.createIterator(),y=0;while((s=x.getNextRange())&&++y){var z=s.getBoundaryNodes(),A=z.startNode,B=z.endNode;if(A.type==1&&A.getName()=='td')s.setStartAt(z.startNode,1);if(B.type==1&&B.getName()=='td')s.setEndAt(z.endNode,2);var C=s.createIterator(),D;C.forceBrBreak=this.state==2;while(D=C.getNextParagraph()){if(D.getCustomData('list_block'))continue;else CKEDITOR.dom.element.setMarker(w,D,'list_block',1);var E=new CKEDITOR.dom.elementPath(D),F=E.elements,G=F.length,H=null,I=0,J=E.blockLimit,K;for(var L=G-1;L>=0&&(K=F[L]);L--){if(a[K.getName()]&&J.contains(K)){J.removeCustomData('list_group_object_'+y);var M=K.getCustomData('list_group_object');if(M)M.contents.push(D);else{M={root:K,contents:[D]};v.push(M);CKEDITOR.dom.element.setMarker(w,K,'list_group_object',M);}I=1;break;}}if(I)continue;var N=J;if(N.getCustomData('list_group_object_'+y))N.getCustomData('list_group_object_'+y).contents.push(D);else{M={root:N,contents:[D]};CKEDITOR.dom.element.setMarker(w,N,'list_group_object_'+y,M);v.push(M);}}}var O=[];while(v.length>0){M=v.shift();if(this.state==2){if(a[M.root.getName()])h.call(this,m,M,w,O);
else j.call(this,m,M,O);}else if(this.state==1&&a[M.root.getName()])k.call(this,m,M,w);}for(L=0;L<O.length;L++){H=O[L];var P,Q=this;(P=function(R){var S=H[R?'getPrevious':'getNext'](CKEDITOR.dom.walker.whitespaces(true));if(S&&S.getName&&S.getName()==Q.type){S.remove();S.moveChildren(H,R);}})();P(1);}CKEDITOR.dom.element.clearAllMarkers(w);o.selectBookmarks(u);m.focus();}};CKEDITOR.plugins.add('definitionlist',{requires:['domiterator','list'],init:function(m){var n=m.addCommand('definitionlist',new l('definitionlist','dl')),o=m.addCommand('definitionterm',new l('definitionterm','dt')),p=m.addCommand('definitiondesc',new l('definitiondesc','dd')),q=this,r=function(s,t,u,v){var w={label:m.lang[t],command:s};if(!w.icon){w.icon=m.config.mindtouch.editorPath+'/images/icons.png';w.iconOffset=v;}return w;};m.ui.addButton('DefinitionList',r('definitionlist','definitionList','dl.gif',7));m.ui.addButton('DefinitionTerm',r('definitionterm','definitionTerm','dt.gif',8));m.ui.addButton('DefinitionDescription',r('definitiondesc','definitionDesc','dd.gif',6));m.on('selectionChange',CKEDITOR.tools.bind(g,n));m.on('selectionChange',CKEDITOR.tools.bind(g,o));m.on('selectionChange',CKEDITOR.tools.bind(g,p));}});})();(function(){var a='extensions',b={canUndo:false,exec:function(c){this.editor=c;var d=c.getSelection(),e=d&&d.getRanges(true)[0],f='';if(e&&!e.collapsed){d.lock();f=e.cloneContents().getFirst().getText();d.unlock(true);}var g={sSelection:f,elParent:d.getStartElement().getParent()},h=CKEDITOR.plugins.get('mindtouchdialog');h.openDialog(c,a,{url:c.config.mindtouch.commonPath+'/popups/extension_dialog.php',width:'700px',height:'400px',params:g,callback:this._.insertExtension,scope:this});},_:{insertExtension:function(c){var d=this.editor;if(c.sDekiScript)d.insertHtml(CKEDITOR.tools.htmlEncode(c.sDekiScript));}}};CKEDITOR.plugins.add(a,{requires:['mindtouchdialog','selection'],init:function(c){c.addCommand(a,b);c.ui.addButton('Extensions',{label:c.lang.extensions.toolbar,command:a,icon:c.config.mindtouch.editorPath+'/images/icons.png',iconOffset:9});}});})();(function(){var a=function(c){var d=c.data,e=Deki.$(d.getThemeSpace('top').$),f=Deki.$(d.container.$),g=Deki.$(CKEDITOR.document.$).scrollTop(),h=parseInt(f.css('padding-top'))||0,i=f.position().top+h,j=null;if(g>i){var k=$('#cke_contents_'+d.name),l=k.position().top+k.height()-e.height();if(g<l)j=g-i;}else{var m=e.position().top;if(m!=i)j=0;}if(j!==null)e.css('top',j+'px');};function b(c){var d=c.editor;if(d.config.floating_toolbar){var e=CKEDITOR.document.getWindow(),f=d.container,g=f.getDocumentPosition(),h=e.getScrollPosition(),i=Deki.$(d.getThemeSpace('top').$),j=g.y-i.height();
if(j<0)j=0;if(h.y>g.y)e.$.scrollTo(0,j);}};CKEDITOR.plugins.add('floatingtoolbar',{init:function(c){if(c.config.floating_toolbar){var d=CKEDITOR.document.getWindow().$;c.on('themeLoaded',function(e){Deki.$(d).bind('scroll',c,a);});c.on('destroy',function(e){Deki.$(d).unbind('scroll',a);});c.on('mode',b,null,null,1);c.on('contentDom',b,null,null,1);c.on('save',b,null,null,1);c.on('cancel',b,null,null,1);c.on('scrollToTop',b,null,null,1);}}});})();CKEDITOR.config.floating_toolbar=true;(function(){var a=null;function b(k){return d(k.getAttribute('data-cke-saved-style'));};function c(k){return d(k.getStyleAttribute(true));};function d(k){var l={};if(typeof k!=='string'||k.length==0)return l;k=k.replace(/[\n\r]/g,'');k=k.replace(/\s+/g,' ');k=k.replace(/\/\*.*\*\//g,'');var m=k.split(';'),n,o,p,q;for(n=0;n<m.length;n++){if(m[n].indexOf(':')===-1)continue;o=h(':',m[n],2);p=CKEDITOR.tools.trim(o[0]).toLowerCase();q=CKEDITOR.tools.trim(o[1]);l[p]=q;}return l;};function e(k,l){if(g(k))k.$.setAttribute('data-cke-saved-style',l);};function f(k){var l=[],m,n;for(m in k)l.push(m+': '+k[m]);n=l.join('; ');if(n.length)n+=';';return n;};function g(k){var l=false,m,n;for(m in CKEDITOR.instances){n=CKEDITOR.instances[m];if(n.document&&n.document.equals(k.getDocument())){l=true;break;}}return l;};function h(k,l,m){var n={0:''};if(arguments.length<2||typeof arguments[0]=='undefined'||typeof arguments[1]=='undefined')return null;if(k===''||k===false||k===null)return false;if(typeof k=='function'||typeof k=='object'||typeof l=='function'||typeof l=='object')return n;if(k===true)k='1';if(!m)return l.toString().split(k.toString());else{var o=l.toString().split(k.toString()),p=o.splice(0,m-1),q=o.join(k.toString());p.push(q);return p;}};function i(){if(a){var k;if(a.is&&a.is('img'))k=new CKEDITOR.dom.nodeList([a.$]);else k=a.getChildren();j(k,'img');a=null;}};function j(k){var l,m,n,o,p,q=CKEDITOR.tools.isArray(arguments[1])?arguments[1]:[arguments[1]];for(n=0;n<k.count();n++){m=k.getItem(n);if(m.type!==1)continue;if(m.is.apply(m,q)){p=b(m);o=c(m);for(l in p)p[l]=m.getStyle(l)||p[l];for(l in o)p[l]=o[l];e(m,f(p));}j(m.getChildren());}};CKEDITOR.plugins.add('inlinestyle',{requires:['styles'],beforeInit:function(k){CKEDITOR.tools.extend(CKEDITOR.dom.element.prototype,{getAttribute:(function(){var l=function(m){if(m=='style')return this.getStyleAttribute();else return this.$.getAttribute(m,2);};if(CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat))return function(m){var q=this;
switch(m){case 'class':m='className';break;case 'tabindex':var n=l.call(q,m);if(n!==0&&q.$.tabIndex===0)n=null;return n;break;case 'checked':var o=q.$.attributes.getNamedItem(m),p=o.specified?o.nodeValue:q.$.checked;return p?'checked':null;}return l.call(q,m);};else return l;})(),getStyleAttribute:(function(){var l=function(m){if(!m&&this.hasAttribute('data-cke-saved-style'))return this.$.getAttribute('data-cke-saved-style',2);else return this.$.getAttribute('style',2);};if(CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat))return function(m){if(!m&&this.hasAttribute('data-cke-saved-style'))return this.$.getAttribute('data-cke-saved-style');else return this.$.style.cssText;};else return l;})(),setAttribute:(function(){var l=function(m,n){this.$.setAttribute(m,n);if(m=='style')e(this,n);return this;};if(CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat))return function(m,n){var o=this;if(m=='class')o.$.className=n;else if(m=='style'){o.$.style.cssText=n;e(o,n);}else if(m=='tabindex')o.$.tabIndex=n;else if(m=='checked')o.$.checked=n;else l.apply(o,arguments);return o;};else return l;})(),removeAttribute:(function(){var l=function(m){this.$.removeAttribute(m);if(m=='style'&&this.hasAttribute('data-cke-saved-style'))this.$.removeAttribute('data-cke-saved-style');};if(CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat))return function(m){if(m=='class')m='className';else if(m=='tabindex')m='tabIndex';l.call(this,m);};else return l;})(),removeStyle:function(l){var p=this;var m;if(!p.hasAttribute('data-cke-saved-style')){p.setStyle(l,'');if(p.$.style.removeAttribute)p.$.style.removeAttribute(CKEDITOR.tools.cssStyleToDomStyle(l));m=p.$.style.cssText;}else{var n=b(p);if(n[l])delete n[l];m=f(n);var o=CKEDITOR.style.getStyleText({styles:n});p.$.style.cssText=o;}if(!m)p.removeAttribute('style');else if(g(p))p.$.setAttribute('data-cke-saved-style',m);},setStyle:function(l,m){var q=this;var n;if(!q.hasAttribute('data-cke-saved-style')){q.$.style[CKEDITOR.tools.cssStyleToDomStyle(l)]=m;n=q.$.style.cssText;}else{var o=b(q);o[l]=m;n=f(o);var p=CKEDITOR.style.getStyleText({styles:o});q.$.style.cssText=p;}if(g(q))q.$.setAttribute('data-cke-saved-style',n);return q;},copyAttributes:function(l,m){var s=this;var n=s.$.attributes;m=m||{};for(var o=0;o<n.length;o++){var p=n[o],q=p.nodeName.toLowerCase(),r;if(q in m)continue;if(q=='checked'&&(r=s.getAttribute(q)))l.setAttribute(q,r);else if(p.specified||CKEDITOR.env.ie&&p.nodeValue&&q=='value'){r=s.getAttribute(q);
if(r===null)r=p.nodeValue;l.setAttribute(q,r);}}if(s.$.style.cssText.length||s.hasAttribute('data-cke-saved-style'))l.$.style.cssText=s.getAttribute('data-cke-saved-style')||s.$.style.cssText;}},true);},init:function(k){k.on('contentDom',function(l){k.document.on('mousedown',function(m){a=m.data.getTarget();});k.document.on('mouseup',i);});}});})();(function(){function a(d,e){var f=e.ui._.items[d];if(typeof f=='undefined'||f.type!=1)return null;var g={command:f.command};g=CKEDITOR.tools.extend({},g,f.args[0]);return g;};function b(d,e,f){d.addMenuGroup(e);var g={};for(var h=0;h<f.length;h++){var i=f[h],j=a(i,d);if(j){j.group=e;g[i.toLowerCase()]=j;}}return g;};function c(d,e){var f={};for(var g in e){var h=0,i=e[g].command,j=i&&d.getCommand(i);if(j)h=j.state;f[g]=h;}return f;};CKEDITOR.plugins.add('menubuttons',{requires:['menu','menubutton','mindtouch'],init:function(d){var e=b(d,'insertButton',d.config.menu_insertItems);d.addMenuItems(e);d.ui.add('InsertMenu',5,{label:d.lang.menubuttons.insert,title:d.lang.menubuttons.insert,className:'cke_button_insert',modes:{wysiwyg:1},onMenu:function(){return c(d,e);}});var f=b(d,'viewButton',d.config.menu_viewItems);d.addMenuItems(f);d.ui.add('ViewMenu',5,{label:d.lang.menubuttons.view,title:d.lang.menubuttons.view,className:'cke_button_view',modes:{wysiwyg:1,source:1},onMenu:function(){var g,h,i,j;for(j=0;j<d.config.menu_viewItems.length;j++){i=d.config.menu_viewItems[j].toLowerCase();g=d.getMenuItem(i);switch(i){case 'source':h=d.mode=='source'?d.lang.mindtouch.wysiwyg:d.lang.source;break;case 'showblocks':var k=d.getCommand('showblocks').state;h=k==1?d.lang.mindtouch.hideBlocks:d.lang.showBlocks;break;}if(g&&h)g.label=h;}return c(d,f);},onRender:function(){var g=this,h=function(){for(var i=0;i<d.config.menu_viewItems.length;i++){var j=a(d.config.menu_viewItems[i],d),k=j&&d.getCommand(j.command);if(k&&k.state==1){g.setState(1);return;}}g.setState(2);};d.on('afterCommandExec',function(){h();});d.on('mode',function(){h();});}});}});})();CKEDITOR.config.menu_insertItems=['Comment','DekiScript','JEM','CSS'];CKEDITOR.config.menu_viewItems=['Source','ShowBlocks'];(function(){var a=false,b=function(f){var g=f.data.path.elements,h=f.editor;if(h.mode!='wysiwyg')return false;a=false;for(var i=0;i<g.length;i++){if(g[i].is('h1')&&h.document.getBody().getFirst().equals(g[i])){a=true;return false;}}for(var j in h._.commands){if(CKEDITOR.tools.indexOf(h.config.header_ignoreCommands,j)==-1)h._.commands[j].enable();}return true;},c=function(f){var g=f.editor;
if(!a)return false;for(var h in g._.commands){if(CKEDITOR.tools.indexOf(g.config.header_ignoreCommands,h)==-1)g._.commands[h].disable();}return true;},d=function(f,g,h,i){var j=h.command;if(j){var k=new CKEDITOR.style(i);f.attachStyleStateChange(k,function(l){f.getCommand(j).setState(l);});f.addCommand(j,new CKEDITOR.styleCommand(k));}f.ui.addButton(g,h);},e=function(f){var g=this;if(f.name=='keypress'){var h=f.data.getKeystroke();if(h<33||h>40)return;}var i=function(){var j=g.getSelection(),k=j&&j.getRanges(true),l=k&&k[0];if(!l||!l.collapsed)return;var m=l.endContainer;if(m.type!=3)return;var n=m.getLength();if(n!=l.endOffset)return;var o=m.getText().lastIndexOf('\n');if(n>0&&o==n-1){l=new CKEDITOR.dom.range(g.document);l.setStart(m,o);l.setEnd(m,o);j.selectRanges([l]);}};setTimeout(i,1);};CKEDITOR.plugins.add('mindtouch',{requires:['button','format','selection','styles'],beforeInit:function(f){f.lang.pagebreak=f.lang.fakeobjects.div;var g=this.path;d(f,'Comment',{label:f.lang.mindtouch.comment,command:'comment',icon:f.config.mindtouch.editorPath+'/images/icons.png',iconOffset:5},f.config.mindtouchStyles_comment);d(f,'DekiScript',{label:f.lang.mindtouch.dekiscript,command:'dekiscript',icon:f.config.mindtouch.editorPath+'/images/icons.png',iconOffset:14},f.config.mindtouchStyles_dekiscript);d(f,'JEM',{label:f.lang.mindtouch.jem,command:'jem',icon:f.config.mindtouch.editorPath+'/images/icons.png',iconOffset:13},f.config.mindtouchStyles_jem);d(f,'CSS',{label:f.lang.mindtouch.css,command:'css',icon:f.config.mindtouch.editorPath+'/images/icons.png',iconOffset:12},f.config.mindtouchStyles_css);},init:function(f){f.skin.editor.css.push(f.config.mindtouch.editorPath+'/skin.css');f.on('selectionChange',b,null,null,-1);f.on('selectionChange',c,null,null,100);f.lang.format.tag_h6=f.lang.format.tag_h5;f.lang.format.tag_h5=f.lang.format.tag_h4;f.lang.format.tag_h4=f.lang.format.tag_h3;f.lang.format.tag_h3=f.lang.format.tag_h2;f.lang.format.tag_h2=f.lang.format.tag_h1;CKEDITOR.tools.extend(f.lang.format,f.lang.mindtouch.format,true);var g=this.path,h={},i='formatButton';f.addMenuGroup(i);h.h1={label:f.lang.format.tag_h2,command:'h1',icon:f.config.mindtouch.editorPath+'/images/icons.png',iconOffset:17,group:i};h.h2={label:f.lang.format.tag_h3,command:'h2',icon:f.config.mindtouch.editorPath+'/images/icons.png',iconOffset:18,group:i};h.h3={label:f.lang.format.tag_h4,command:'h3',icon:f.config.mindtouch.editorPath+'/images/icons.png',iconOffset:19,group:i};h.h4={label:f.lang.format.tag_h5,command:'h4',icon:f.config.mindtouch.editorPath+'/images/icons.png',iconOffset:20,group:i};
h.h5={label:f.lang.format.tag_h6,command:'h5',icon:f.config.mindtouch.editorPath+'/images/icons.png',iconOffset:21,group:i};f.addMenuItems(h);f.ui.add('Hx',5,{label:f.lang.mindtouch.format.tag_hx,title:f.lang.mindtouch.format.tag_hx,className:'cke_button_hx',icon:f.config.mindtouch.editorPath+'/images/icons.png',iconOffset:23,modes:{wysiwyg:1},onMenu:function(){var l={};for(var m=0;m<f.config.menu_hxItems.length;m++){var n=f.config.menu_hxItems[m].toLowerCase(),o=0,p=h[n].command,q=p&&f.getCommand(p);if(q)o=q.state;l[n]=o;}return l;},onRender:function(){var l=this;f.on('selectionChange',function(){var m=2;for(var n=0;n<f.config.menu_hxItems.length;n++){var o=f.config.menu_hxItems[n].toLowerCase(),p=f.getCommand(h[o].command);if(p&&p.state==1)m=1;}l.setState(m);});}});var j=f.config.enterMode==3?'div':'p';d(f,'Normal',{label:f.lang.format['tag_'+j],command:'normal'},f.config['format_'+j]);d(f,'Code',{label:f.lang.mindtouch.code,command:'code',icon:f.config.mindtouch.editorPath+'/images/icons.png',iconOffset:15},f.config.mindtouchStyles_code);d(f,'H1',h.h1,f.config.format_h2);d(f,'H2',h.h2,f.config.format_h3);d(f,'H3',h.h3,f.config.format_h4);d(f,'H4',h.h4,f.config.format_h5);d(f,'H5',h.h5,f.config.format_h6);f.on('dataReady',function(){CKEDITOR.fireOnce('editorLoaded',null,f);});f.on('paste',function(l){if(l.data.html){var m=l.data.html;if(f.config.paste_removeStyles||CKEDITOR.env.webkit&&f.config.paste_removeStylesWebkit){var n=new CKEDITOR.dom.element('div',f.document);n.setHtml(m);var o=n.getNextSourceNode(false,1);while(o){o.removeAttribute('style');o=o.getNextSourceNode(false,1);}l.data.html=n.getHtml();}if(CKEDITOR.env.webkit||CKEDITOR.env.opera){var p=CKEDITOR.htmlParser.fragment.fromHtml(m),q=new CKEDITOR.htmlParser.fragment(),r=new CKEDITOR.htmlParser.element('table'),s=false,t=CKEDITOR.dtd,u;for(u=0;u<p.children.length;u++){var v=p.children[u];if(t.$tableContent[v.name]){r.add(v);s=true;}else{if(r.children.length){q.add(r);r=new CKEDITOR.htmlParser.element('table');}q.add(v);}}if(r.children.length)q.add(r);if(s){var w=new CKEDITOR.htmlParser.basicWriter();q.writeHtml(w);l.data.html=w.getHtml(true);}}}});f.on('insertHtml',function(l){var m=l.editor;if(m.mode=='wysiwyg'&&CKEDITOR.env.webkit){var n=l.data;if(/<(p|div|h[1-6]|ul|ol)/.test(n)){m.focus();var o=m.getSelection(),p=o&&o.getRanges(true)[0];if(p&&p.collapsed&&p.startContainer.is&&p.startContainer.is('p','h1','h2','h3','h4','h5','h6')){var q=p.startContainer.getFirst();if(!q||!q.getNext()&&(q.is&&q.is('br')||q.type==3&&q.getText().length==0)){m.fire('saveSnapshot');
if(m.dataProcessor)n=m.dataProcessor.toHtml(n);var r=new CKEDITOR.dom.element('div',m.document);r.setHtml(n);var s=r.getChildren();while(s.count())s.getItem(0).insertBefore(p.startContainer);CKEDITOR.tools.setTimeout(function(){m.fire('saveSnapshot');},0);l.cancel();}}}}});f.on('contentDom',function(){if(CKEDITOR.env.gecko){f.document.on('keypress',e,f);f.document.on('click',e,f);f.document.getBody().on('beforepaste',function(){var l=f.getSelection(),m=l&&l.getRanges(true),n=m&&m[0],o=l&&l.getStartElement().getAscendant('pre',true);if(n&&n.collapsed&&o){var p=n.endContainer,q,r;if(p.is&&p.is('pre'))q=p.getChildren().getItem(n.endOffset);else if(p&&p.type==3)q=p.getNext();if(q&&q.is&&q.is('br')){r=f.document.createText('\n');r.replace(q);window.setTimeout(function(){q.replace(r);},0);}}});}});f.on('instanceReady',function(){var l=CKEDITOR.dtd;for(var m in CKEDITOR.tools.extend({},l.$nonBodyContent,l.$block,l.$listItem,l.$tableContent))this.dataProcessor.writer.setRules(m,{breakAfterOpen:0});});f.on('themeLoaded',function(){var l=f.getCommand('normal'),m=l&&l.uiItems[0];if(m){var n=CKEDITOR.document.getById(m._.id);n.removeAttribute('onclick');n.on('click',function(o){if(o.data.$.shiftKey){var p=f.getSelection(),q=p&&p.getStartElement(),r=new CKEDITOR.dom.elementPath(q),s=r.blockLimit,t=CKEDITOR.dtd;if(s.is('body'))s=r.block;else if(t.$tableContent[s.getName()])s=r.block||r.blockLimit.getAscendant('table',true);if(t.$listItem[s.getName()])for(var u=r.elements.length-1;u>=0;u--){var v=r.elements[u];if(t.$list[v.getName()]){s=v;break;}}var w=f.config.enterMode==1?'p':'div',x=f.document.createElement(w);f.fire('saveSnapshot');if(!CKEDITOR.env.ie)x.appendBogus();x.insertAfter(s);var y=new CKEDITOR.dom.range(f.document);y.moveToElementEditStart(x);y.select();x.scrollIntoView();f.fire('saveSnapshot');}else f.execCommand(m.command);});}});var k={address:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,pre:1,blockquote:1};f.on('removeFormatCleanup',function(l){var m=l.data,n=m.getName(),o=CKEDITOR.dtd;if(n in k||n in o.$listItem)m.renameNode(f.config.enterMode==1?'p':'div');else if(n in o.$list)m.remove(1);});}});})();CKEDITOR.config.header_ignoreCommands=['mindtouchsave','mindtouchcancel','source','undo','redo','find','replace','removeFormat','maximize','about','blur','blurBack','checkspell','copy','cut','paste','newpage','pagebreak','preview','print','scaytcheck','selectAll','shiftTab','showblocks','tab','toolbarCollapse','toolbarFocus','atd'];CKEDITOR.config.mindtouchStyles_code={element:'code'};
CKEDITOR.config.mindtouchStyles_comment={element:'p',attributes:{'class':'comment'}};CKEDITOR.config.mindtouchStyles_dekiscript={element:'pre',attributes:{'class':'script'}};CKEDITOR.config.mindtouchStyles_jem={element:'pre',attributes:{'class':'script-jem'}};CKEDITOR.config.mindtouchStyles_css={element:'pre',attributes:{'class':'script-css'}};CKEDITOR.config.menu_hxItems=['H4','H5'];CKEDITOR.config.paste_removeStyles=false;CKEDITOR.config.paste_removeStylesWebkit=true;(function(){CKEDITOR.plugins.add('mindtouchdialog',{openDialog:function(a,b,c){if(!Deki.Dialog)return;this.dialogName=b;this.dialogParams=CKEDITOR.tools.extend(c,{height:'auto',buttons:[Deki.Dialog.BTN_OK,Deki.Dialog.BTN_CANCEL],extra:{}});var d={src:this.dialogParams.url,width:this.dialogParams.width,height:this.dialogParams.height,buttons:this.dialogParams.buttons,args:this.dialogParams.params,callback:function(){a.focus();if(a.mode=='wysiwyg'&&CKEDITOR.env.ie){var j=a.getSelection();j&&j.unlock(true);}if(arguments[0])this.dialogParams.callback.apply(this.dialogParams.scope,arguments);},forceCallback:true,scope:this};CKEDITOR.tools.extend(d,this.dialogParams.extra);var e=new Deki.Dialog(d);e.render();if(a.mode=='wysiwyg'&&CKEDITOR.env.ie){var f=a.getSelection();f&&f.lock();var g=a.document.$.selection,h=g.createRange();if(h)if(h.parentElement&&h.parentElement().ownerDocument==a.document.$||h.item&&h.item(0).ownerDocument==a.document.$){var i=document.body.createTextRange();i.moveToElementText(e._oContainer);i.collapse(true);i.select();}}e.show();}});})();(function(){var a='mindtouchimage',b={canUndo:false,exec:function(c){this.editor=c;var d=c.getSelection().getSelectedElement();if(!(d&&d.getName()=='img'&&!d.data('cke-realelement'))&&!(d&&d.getName()=='input'&&d.getAttribute('type')=='image'))d=null;var e={};if(d){var f='';if(d.hasClass('rwrap'))f='right';else if(d.hasClass('lwrap'))f='left';else f='default';var g=parseInt(d.getComputedStyle('width'))||parseInt(d.getStyle('width'))||parseInt(d.getAttribute('width'))||0,h=parseInt(d.getComputedStyle('height'))||parseInt(d.getStyle('height'))||parseInt(d.getAttribute('height'))||0;e={bInternal:d.hasClass('internal'),sSrc:d.data('cke-saved-src')||d.getAttribute('src'),sAlt:d.getAttribute('alt'),sWrap:f,nWidth:g,nHeight:h};}e.nPageId=c.config.mindtouch.pageId;e.sUserName=c.config.mindtouch.userName;var i=c.config.mindtouch.commonPath+'/popups/image_dialog.php?contextID='+c.config.mindtouch.pageId;if(d)i+='&update=true';var j=CKEDITOR.plugins.get('mindtouchdialog');
j.openDialog(c,a,{url:i,width:'600px',height:'370px',params:e,callback:this._.insertImage,scope:this});},_:{insertImage:function(c){var d=this.editor,e=d.document.createElement('img');e.setAttribute('alt','');try{e.data('cke-saved-src',c.sSrc);e.setAttribute('src',c.sSrc);if(c.nWidth||c.nHeight){e.setStyle('width',c.nWidth+'px');e.setStyle('height',c.nHeight+'px');}if(c.sAlt)e.setAttribute('alt',c.sAlt);var f=c.bInternal?'internal ':'';e.setAttribute('class',f+c.sWrapClass);switch(c.sWrap){case 'left':case 'right':e.setAttribute('align',c.sWrap);break;default:if(e.hasAttribute('align'))e.removeAttribute('align');break;}if(c.sFullSrc&&c.sFullSrc.length>0){var g=e&&e.getAscendant('a');if(!g)g=d.document.createElement('a');g.setAttribute('href',c.sFullSrc);g.data('cke-saved-href',c.sFullSrc);if(c.sAlt)g.setAttribute('title',c.sAlt);d.insertElement(g);g.append(e,false);}else d.insertElement(e);}catch(h){}}}};CKEDITOR.plugins.add(a,{requires:['mindtouchdialog'],init:function(c){c.addCommand(a,b);c.ui.addButton('MindTouchImage',{label:c.lang.common.image,command:a});if(c.addMenuItems)c.addMenuItems({image:{label:c.lang.image.menu,command:'mindtouchimage',group:'image'}});c.on('doubleclick',function(d){var e=d.data.element;if(e.is('img')&&!e.data('cke-realelement'))if(c.execCommand(a))d.cancel();},this,null,1);}});})();(function(){var a='mindtouchlink',b={canUndo:false,exec:function(e){var m=this;m.editor=e;var f=e.getSelection(),g=null,h=CKEDITOR.plugins.link;if((g=h.getSelectedLink(e))&&g.hasAttribute('href'))f.selectElement(g);else g=null;var i=m._.parseLink.apply(m,[g]),j=e.config.mindtouch.pageTitle;if(j.utf8URL)j=j.utf8URL();var k=[e.config.mindtouch.commonPath+'/popups/link_dialog.php','?href='+i.f_href,'&contextID='+e.config.mindtouch.pageId,'&cntxt='+j,'&userName='+e.config.mindtouch.userName],l=CKEDITOR.plugins.get('mindtouchdialog');l&&l.openDialog(e,a,{url:k.join(''),width:'600px',height:'285px',params:i,callback:m._.insertLink,scope:m});return true;},_:{parseLink:function(e){var f=this.editor,g=e&&(e.data('cke-saved-href')||e.getAttribute('href'))||'',h={f_href:g,f_text:e?e.getText():'',contextTopic:f.config.mindtouch.pageTitle,contextTopicID:f.config.mindtouch.pageId,userName:f.config.mindtouch.userName};if(!e){var i=f.getSelection(),j=i&&i.getRanges(true)[0],k='';if(j&&!j.collapsed){i.lock();var l=j.cloneContents().getChildren();for(var m=0;m<l.count();m++)k+=l.getItem(m).getText();i.unlock(true);}h.f_href=d.isLinkInternal(k)?'./'+encodeURIComponent(k):encodeURI(k);
h.f_text=k;h.newlink=true;}if(h.f_href.indexOf(d.internalPrefix)==0)h.f_href=h.f_href.substr(d.internalPrefix.length);this._.selectedElement=e;return h;},insertLink:function(e){var o=this;var f={},g=o.editor,h=e.f_text.length?e.f_text:e.f_href;f['data-cke-saved-href']=d.normalizeUri(e.f_href);f.href=f['data-cke-saved-href'];f.title=h;g.fire('saveSnapshot');if(f.title.indexOf(d.internalPrefix)==0){f.title=f.title.substr(d.internalPrefix.length);if(o._.selectedElement)o._.selectedElement.removeClass('external');}if(!o._.selectedElement){var i=g.getSelection(),j=i&&i.getRanges(true),k=j&&j.length==1&&j[0];if(k&&k.collapsed){var l=new CKEDITOR.dom.text(h,g.document);k.insertNode(l);k.selectNodeContents(l);i.selectRanges(j);}var m=new CKEDITOR.style({element:'a',attributes:f});m.type=2;m.apply(g.document);}else{var n=o._.selectedElement;n.setAttributes(f);delete o._.selectedElement;}g.fire('saveSnapshot');}}},c=CKEDITOR.tools.clone(b);c.exec=function(e){var g=this;g.editor=e;var f=g._.parseLink.apply(g,[null]);g._.insertLink.apply(g,[f]);};var d={requires:['mindtouchdialog','selection'],init:function(e){var f=this;e.addCommand(a,b);e.addCommand('quicklink',c);var g=e.keystrokeHandler.keystrokes;g[1000+75]=a;g[1000+87]='quicklink';e.ui.addButton('MindTouchLink',{label:e.lang.link.toolbar,command:a,icon:e.config.mindtouch.editorPath+'/images/icons.png',iconOffset:0});e.ui.addButton('Unlink',{label:e.lang.unlink,command:'unlink',icon:e.config.mindtouch.editorPath+'/images/icons.png',iconOffset:1});e.on('doubleclick',function(h){var i=CKEDITOR.plugins.link.getSelectedLink(e)||h.data.element;if(!i.isReadOnly())if(i.is('a')&&i.getAttribute('href'))if(e.execCommand(a))h.cancel();},this,null,1);if(e.addMenuItems)e.addMenuItems({link:{label:e.lang.link.menu,command:'mindtouchlink',icon:e.config.mindtouch.editorPath+'/images/icons.png',iconOffset:0,group:'link',order:1},unlink:{label:e.lang.unlink,command:'unlink',icon:e.config.mindtouch.editorPath+'/images/icons.png',iconOffset:1,group:'link',order:5}});},internalPrefix:'mks://localhost/',externalRegex:/^([a-z]+:)[\/]{2,5}/i,emailRegex:/^(mailto:)?[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,isLinkExternal:function(e){return e.match(this.externalRegex)!=null&&e.indexOf(this.internalPrefix)!=0;},isLinkInternal:function(e){return!(this.isLinkExternal(e)||this.isLinkNetwork(e)||this.isEmail(e));},isLinkNetwork:function(e){return e.indexOf('\\')==0||e.indexOf('//')==0;
},isEmail:function(e){return this.emailRegex.test(e);},normalizeUri:function(e){var f=this;if(f.isEmail(e)){if(e.toLowerCase().indexOf('mailto:')!=0)e='mailto:'+e;return e;}if(f.isLinkNetwork(e))return 'file:///'+e.replace(/\\/g,'/');if(f.isLinkExternal(e))return e;if(e!=''&&e.indexOf(f.internalPrefix)!=0&&e.indexOf('/')!=0)e=f.internalPrefix+e;e=e.replace(/ /g,'_');return e;}};CKEDITOR.plugins.add(a,d);})();(function(){var a='mindtouchkeystrokes',b=function(q){var r=this;r.fire('saveSnapshot');var s=new CKEDITOR.style(r.config['format_'+q]);s.apply(r.document);r.fire('saveSnapshot');},c=function(q){var r=this,s=q==2000+9,t=q==1000+9,u=r.getSelection(),v=u&&u.getRanges(true)[0];if(!v)return false;var w=r.config.tabSpaces,x='';while(w--)x+='\xa0';var y=v.startContainer,z=false;while(y){if(y.type==1)if(y.is('td','th')){if(z){var A=v.checkStartOfBlock();if(A||!A&&t)break;}var B=s?y.getPrevious(d):y.getNext(d);if(B==null){var C=s?y.getParent().getPrevious(e):y.getParent().getNext(e);if(C)B=s?C.getLast(d):C.getFirst(d);}if(B==null){if(s)break;r.fire('saveSnapshot');var D=y.getAscendant('table').$,E=y.getParent().$.cells,F=D.rows,G=new CKEDITOR.dom.element(D.insertRow(-1),r.document),H,I;for(H=0,I=E.length;H<I;H++){var J=G.append(new CKEDITOR.dom.element(E[H],r.document).clone(false,false));!CKEDITOR.env.ie&&J.appendBogus();if(H==0)B=J;}r.fire('saveSnapshot');}if(B!=null){v.moveToElementEditStart(B);v.select();return true;}}else if(y.is('tr','tbody','table'))return true;else if(y.is('dt')||y.is('dd')&&s){var K=u.createBookmarks();y.renameNode(y.getName()=='dt'?'dd':'dt');u.selectBookmarks(K);return true;}else if(!s&&y.is('pre')&&x.length){r.fire('saveSnapshot');var L=new CKEDITOR.dom.text(x,r.document);v.deleteContents();v.insertNode(L);v.setStartAt(L,2);v.collapse(true);v.select();r.fire('saveSnapshot');return true;}else if(y.is('li'))z=true;y=y.getParent();}if(!s){var M=v.getCommonAncestor(true,true),N;if(M&&M.is('h1','h2','h3','h4','h5','h6')){N=M.getNextSourceNode(false,1);if(!N){N=new CKEDITOR.dom.element(r.config.enterMode==3?'div':'p',r.document);N.insertAfter(M);}v.moveToElementEditStart(N);v.select();return true;}if(x.length&&!v.checkStartOfBlock()){r.insertHtml(x);return true;}}r.execCommand(s?'outdent':'indent');return true;},d=function(q){return function(r){var s=r&&r.is('td','th');return q^s;};},e=function(q){return function(r){var s=r&&r.getName()=='tr';return q^s;};},f=function(){var q=this,r;if(q.getCommand('bulletedlist').state==1)r='numberedlist';
else if(q.getCommand('numberedlist').state==1){var s=new CKEDITOR.dom.elementPath(q.getSelection().getStartElement());r='numberedlist';var t=0,u,v;for(var w=0;w<s.elements.length;w++){u=s.elements[w];if(u.is('ul','ol'))t++;if(t>1)r='bulletedlist';}}else r='bulletedlist';if(q.getCommand(r).state!=0){q.execCommand(r);return true;}return false;},g={exec:function(q,r){var y=this;y.editor=q;r=q.config.forceEnterMode||r;var s=r?q.config.shiftEnterMode:q.config.enterMode;if(s==2)return false;var t=q.getSelection(),u=t&&t.getRanges(true),v=u&&u[0];if(!v||!v.collapsed)return false;var w=v.getCommonAncestor(true,true);if(w.is('pre'))return false;q.fire('saveSnapshot');var x=t&&t.createBookmarks(true);y.replace(w,'~~~~',y.getNodesToReplace(true));y.replace(w,'~~~',y.getNodesToReplace(false));if(CKEDITOR.env.gecko)w.setHtml(w.getHtml());t.selectBookmarks(x);q.fire('saveSnapshot');return false;},replace:function(q,r,s){var t=q;while(t=t.getNextSourceNode(false,3,q)){var u=new CKEDITOR.dom.elementPath(t),v=false,w;for(w=0;w<u.elements.length;w++){if(u.elements[w].hasClass('plain')){v=true;break;}}if(v)continue;var x=t.getText().indexOf(r);if(x>-1){var y=new CKEDITOR.dom.range(this.editor.document);y.setStart(t,x);y.setEnd(t,x+r.length);t=this.replaceRange(y,s);}}},replaceRange:function(q,r){q.select();q.deleteContents();var s;for(var t in r){s=r[t];q.insertNode(s);q.moveToPosition(s,4);}return s;},getNodesToReplace:function(q){var w=this;var r=[],s=CKEDITOR.plugins.get('mindtouchlink'),t=s.internalPrefix+'User:'+w.editor.config.mindtouch.userName,u=w.editor.document.createElement('a');u.addClass('internal');u.setAttributes({title:'User:'+w.editor.config.mindtouch.userName,href:t});u.data('cke-saved-href',t);u.setText(w.editor.config.mindtouch.userName);r.push(u);if(q){var v=w.editor.document.createText(' '+w.editor.config.mindtouch.today);r.push(v);}return r;},canUndo:false},h=function(q){return!(q.is&&q.is('br'));},i=function(q){if(q&&q.is&&q.is('br'))q.remove();return q;},j=function(){var q=this,r=q.getSelection(),s=r&&r.getRanges(true),t=s&&s[0];if(!t||!t.collapsed)return false;var u=t.startContainer.getAscendant('li',true);if(u&&t.checkStartOfBlock()){var v=m(u),w=t.clone();w.setStartAt(v,1);var x=new CKEDITOR.dom.walker(w);x.evaluator=function(C){return C.type==3||C.is&&C.is('li')&&C.getChildCount()==0||C.is&&C.is('br')&&C.getParent().is('li')&&C.getParent().getFirst().equals(C);};var y=x.previous();if(y){q.fire('saveSnapshot');if(y.is&&y.is('br'))y=y.getParent();if(y.is&&y.is('li'))t.setStartAt(y,1);
else t.setStartAt(y,2);t.collapse(true);t.select();i(u.getLast());i(y.getAscendant('li',true).getLast());i(y.getNext());l(u,t);t.collapse(true);t.select();q.fire('saveSnapshot');return true;}}if(CKEDITOR.env.webkit){var z=new CKEDITOR.dom.elementPath(t.startContainer);if(z&&z.block&&z.block.is('pre')&&t.checkStartOfBlock()){var A;if(!((A=z.block.getPreviousSourceNode(true,1))&&A.is&&A.is('pre')))return false;q.fire('saveSnapshot');t.setStartAt(A,2);t.collapse(true);t.select();var B=r.createBookmarks(true);n(z.block,A);r.selectBookmarks(B);q.fire('saveSnapshot');return true;}}return false;},k=function(){var q=this,r=q.getSelection(),s=r&&r.getRanges(true),t=s&&s[0];if(!t||!t.collapsed)return false;var u=t.startContainer.getAscendant('li',true);if(!u)return false;q.fire('saveSnapshot');var v,w;if(!t.checkEndOfBlock()){v=t.createBookmark();w=v.startNode.getNext(h);if(!w.is||!w.is('ul','ol')){t.moveToBookmark(v);t.select();return false;}if(!t.checkStartOfBlock())i(w.getPrevious());}var x=m(u),y=t.clone();y.setEndAt(x,2);var z=new CKEDITOR.dom.walker(y);z.evaluator=function(B){return B.is&&B.is('li');};var A=z.next();if(A){i(u.getLast());i(A.getLast());l(A,t);}v?t.moveToBookmark(v):t.collapse(true);t.select();q.fire('saveSnapshot');return true;};function l(q,r){var s=q.getChildren(),t=s.count(),u,v;for(u=t-1;u>=0;u--){v=s.getItem(u);if(v.is&&v.is('br')&&v.getParent().is('li')&&v.getParent().getLast().equals(v))continue;r.insertNode(s.getItem(u));}if(q.getParent().getChildCount()==1)q.getParent().remove();else q.remove();};function m(q){var r=null;while(q){if(q.is&&q.is('ul','ol'))r=q;q=q.getParent();}return r;};function n(q,r){var s=o(r.getHtml(),/(\n|<br\s*\/*>)$/i,'')+q.getHtml();r.setHtml(s);q.remove();};function o(q,r,s){var t='',u='';q=q.replace(/(^<span[^>]+data-cke-bookmark.*?\/span>)|(<span[^>]+data-cke-bookmark.*?\/span>$)/gi,function(v,w,x){w&&(t=w);x&&(u=x);return '';});return t+q.replace(r,s)+u;};var p=function(q){var r=this,s=r.getSelection(),t=s&&s.getRanges(true)[0];if(!t)return false;var u=function(x){var y=x.startContainer;while(y){if(y.is&&y.is('td','th'))break;y=y.getParent();}return y;},v=u(t);if(!v)return false;var w;if(t.startContainer.type==3)w=t.startOffset;window.setTimeout(function(){var x=r.getSelection(),y=x&&x.getRanges(true)[0];if(!y)return false;var z=u(y);if(!z||z.equals(v))return false;var A=v.getParent(),B;if(q==38)B=A&&A.getPrevious(e);else if(q==40)B=A&&A.getNext(e);else return false;if(!B){var C=A.getAscendant('table'),D=C&&C[q==40?'getNext':'getPrevious']();
if(D){y.moveToElementEditStart(D);y.collapse(true);y.select();}return true;}var E=new CKEDITOR.dom.element(B.$.cells[v.$.cellIndex]);if(z.equals(E))return false;if(!isNaN(w)){var F=E[q==40?'getFirst':'getLast']();if(F&&F.type!==3){var G=F.getChildren();for(var H=0;H<G.count();H++){var I=G.getItem(H);if(I.type===3){F=I;break;}}}if(F&&F.type===3&&F.getLength()>=w){y.setStart(F,w);y.collapse(true);y.select();return true;}}y.moveToElementEditStart(E);y.select();return true;},0);};CKEDITOR.plugins.add(a,{requires:['keystrokes','mindtouchlink'],init:function(q){q.addCommand('autoreplace',g);q.on('key',function(r){var s=r.editor,t=r.data.keyCode;switch(t){case 9:case 2000+9:case 1000+9:if(c.call(s,t))r.cancel();break;case 38:case 40:CKEDITOR.env.webkit&&p.call(s,t);break;case 1000+2000+76:f.call(s);r.cancel();break;case 13:case 2000+13:var u=t==2000+13;s.execCommand('autoreplace',u);break;case 8:if(j.call(s))r.cancel();break;case 46:if(k.call(s))r.cancel();break;case 1000+49:case 1000+50:case 1000+51:case 1000+52:case 1000+53:var v='h'+(t-1000-47);b.call(s,v);r.cancel();break;case 1000+48:case 1000+78:var v=s.config.enterMode==3?'div':'p';b.call(s,v);r.cancel();break;}},null,null,1);}});})();(function(){function a(d){var e=d.getCommand('maximize');if(e&&e.state==1)d.execCommand('maximize');};var b={modes:{wysiwyg:1,source:1},editorFocus:false,exec:function(d){var e=this;e.editor=d;a(d);if(Deki.Plugin)Deki.Plugin.Publish('Editor.checkPermissions',[e.save,e]);else e.save();},save:function(){var d=this.editor,e=d.element.$.form;if(e&&!d.config.mindtouch.isReadOnly){d.fire('save');try{e.submit();}catch(f){if(e.submit.click)e.submit.click();}}},canUndo:false},c={exec:function(d){var e=d.fire('checkDirty',{isDirty:false}).isDirty;if(e)d.openDialog('confirmcancel');else{a(d);d.fire('cancel');}},canUndo:false,editorFocus:false,modes:{wysiwyg:1,source:1}};CKEDITOR.plugins.add('mindtouchsave',{requires:['dialog'],init:function(d){var e=d.lang.cancel;d.addCommand('mindtouchsave',b);d.addCommand('mindtouchcancel',c);var f=d.keystrokeHandler.keystrokes;f[1000+2000+83]='mindtouchsave';d.ui.addButton('MindTouchSave',{label:d.lang.save,command:'mindtouchsave'});d.ui.addButton('MindTouchCancel',{label:e.button,command:'mindtouchcancel',icon:d.config.mindtouch.editorPath+'/images/icons.png',iconOffset:4});CKEDITOR.dialog.add('confirmcancel',function(g){return{title:e.discardChangesTitle,minWidth:290,minHeight:90,onShow:function(){this.getButton('ok').focus();},contents:[{id:'info',label:g.lang.discardChangesTitle,title:g.lang.discardChangesTitle,elements:[{id:'warning',type:'html',html:e.confirmCancel}]}],buttons:[CKEDITOR.dialog.cancelButton.override({label:e.continueEditing,'class':'cke_dialog_ui_button_continue'}),CKEDITOR.dialog.okButton.override({label:e.discardChanges,'class':'cke_dialog_ui_button_discard',onClick:function(){a(g);
g.fire('cancel');}})]};});}});})();(function(){CKEDITOR.plugins.add('styletools',{init:function(a){CKEDITOR.tools.extend(CKEDITOR.style,{getNormalizedValue:function(b,c,d){var e='';d=d||c;switch(c){case 'background-image':e=b.getStyle(c).replace(/url\('?([^']*)'?\)/gi,'$1');break;case 'background-color':case 'border-color':if(b.getStyle(c).length>0)e=CKEDITOR.style.convertRGBToHex(b.getStyle(c));else if(c=='background-color'&&b.hasAttribute('bgColor'))e=b.getAttribute('bgColor');else if(c=='border-color'&&b.hasAttribute('borderColor'))e=b.getAttribute('borderColor');break;case 'border-style':e=b.getStyle('border-style');if(e&&e.match(/([^\s]*)\s/))e=RegExp.$1;break;case 'border-width':e=CKEDITOR.style.getNum(b.getStyle('border-width'));break;case 'white-space':if(b.getStyle('white-space').length)e=b.getStyle('white-space');else if(b.hasAttribute('noWrap'))e='nowrap';break;default:e=CKEDITOR.style.getValue(b,c,d);}return e;},getValue:function(b,c,d){var e='',f=b.style;d=d||c;if(b.hasAttribute(d))e=b.getAttribute(d);else e=b.getStyle(c);return e;},convertRGBToHex:function(b){var c=/rgb\s*\(\s*([0-9]+).*,\s*([0-9]+).*,\s*([0-9]+).*\)/gi,d=b.replace(c,'$1,$2,$3').split(','),e,f,g;if(d.length==3){e=parseInt(d[0]).toString(16);f=parseInt(d[1]).toString(16);g=parseInt(d[2]).toString(16);e=e.length==1?'0'+e:e;f=f.length==1?'0'+f:f;g=g.length==1?'0'+g:g;b='#'+e+f+g;}return b;},convertHexToRGB:function(b){if(b.indexOf('#')==0){b=b.replace(/[^0-9A-F]/gi,'');r=parseInt(b.substring(0,2),16);g=parseInt(b.substring(2,4),16);b=parseInt(b.substring(4,6),16);b='rgb('+r+','+g+','+b+')';}else b='';return b;},getUnit:function(b){var c=b.replace(/[0-9]+(px|%|in|cm|mm|em|ex|pt|pc)?/,'$1');if(!c.length)c='px';return c;},getNum:function(b){b=parseInt(b);if(isNaN(b))b='';return b;}});}});})();(function(){var a='mindtouchtemplates',b={canUndo:false,exec:function(c){this.editor=c;var d={contextTopicID:c.config.mindtouch.pageId},e=CKEDITOR.plugins.get('mindtouchdialog');e.openDialog(c,a,{url:c.config.mindtouch.commonPath+'/popups/select_template.php',width:'400px',height:'110px',params:d,callback:this._.insertTemplate,scope:this});},_:{insertTemplate:function(c){var d=this.editor;if(c.f_template)d.insertHtml(c.f_template);}}};CKEDITOR.plugins.add(a,{requires:['mindtouchdialog'],init:function(c){c.addCommand(a,b);c.ui.addButton('MindTouchTemplates',{label:c.lang.mindtouchtemplates.button,command:a,icon:c.config.mindtouch.editorPath+'/images/icons.png',iconOffset:16});}});})();CKEDITOR.plugins.add('tableadvanced',{requires:['styles'],beforeInit:function(a){CKEDITOR.dialog.add('table',this.path+'dialogs/table.js',true);
CKEDITOR.dialog.add('tableProperties',this.path+'dialogs/table.js',true);CKEDITOR.dialog.add('cellProperties',this.path+'dialogs/tableCell.js',true);},init:function(a){a.addCommand('rowProperties',new CKEDITOR.dialogCommand('rowProperties'));CKEDITOR.dialog.add('rowProperties',this.path+'dialogs/tableRow.js');CKEDITOR.tools.extend(a.lang.table,a.lang.tableadvanced);CKEDITOR.tools.extend(a.lang.table.cell,a.lang.tableadvanced.cell);CKEDITOR.tools.extend(a.lang.table.row,a.lang.tableadvanced.row);var b=a.lang.table;if(a.addMenuItems){a.addMenuGroup('tablerowproperties');a.addMenuItems({tablerow:{label:b.row.menu,group:'tablerow',order:1,getItems:function(){return{tablerow_insertBefore:2,tablerow_insertAfter:2,tablerow_delete:2,tablerow_properties:2};}},tablerow_properties:{label:b.row.title,group:'tablerowproperties',command:'rowProperties',order:20}});}}});(function(){var a=function(b){var c=this;CKEDITOR.tools.extend(c,b);if(c.tags&&!CKEDITOR.tools.isArray(c.tags))c.tags=c.tags.toLowerCase().split(',');};a.prototype={apply:function(b){var f=this;for(var c=0,d;c<b.elements.length;c++){d=b.elements[c];if(f.isElementApplicable(d))for(var e in f.attributes){if(e=='class')d.addClass(f.attributes[e]);else d.setAttribute(e,f.attributes[e]);}}},remove:function(b){for(var c=0,d;c<b.elements.length;c++){d=b.elements[c];if(this.isElementApplicable(d))for(var e in this.attributes){if(e=='class')d.removeClass(this.attributes[e]);else d.removeAttribute(e);}}},isApplicable:function(b){for(var c=0,d;c<b.elements.length;c++){d=b.elements[c];if(this.isElementApplicable(d))return true;}return false;},isElementApplicable:function(b){return CKEDITOR.tools.indexOf(this.tags,b.getName())>-1&&!b.isReadOnly();},isActive:function(b){var g=this;var c=false;for(var d=0,e;d<b.elements.length;d++){e=b.elements[d];if(g.isElementApplicable(e)){for(var f in g.attributes){if(f=='class'&&e.hasClass(g.attributes[f])||e.getAttribute(f)==g.attributes[f])c=true;else{c=false;break;}}if(c)break;}}return c;}};CKEDITOR.plugins.add('transformations',{requires:['combobutton','selection'],init:function(b){var c=b.config,d={},e=false,f,g={};b.on('themeLoaded',function(i){var j;for(var k=0;k<b.toolbox.toolbars.length;k++){var l=b.toolbox.toolbars[k];for(var m=0;m<l.items.length;m++){var n=l.items[m];if(n.combo&&n.combo.className&&n.combo.className=='cke_transformations'){j=n.id;break;}}if(j)break;}if(j){f=CKEDITOR.document.getById(j).getFirst();g.image=f.getStyle('background-image');g.pos=f.getStyle('background-position');
f.setStyles({'background-image':'url('+b.config.mindtouch.commonPath+'/icons/anim-wait-circle.gif)','background-position':'0% 0%'});}});var h=function(i){i=typeof i=='function'?i:null;if(e){i&&i();return;}Deki.Plugin.AjaxRequest('json_site_functions',{url:Deki.Plugin.AJAX_URL+'?tt='+Deki.EditorExtensionsToken,data:{method:'transformations'},success:function(j,k){var l=j.body;for(var m=0;m<l.length;m++){var n=l[m],o=n.name||n.func,p={name:o,title:n.title,tags:n.tags,attributes:{'class':'deki-transform','function':n.func}};d[o]=new a(p);}e=true;if(f)f.setStyles({'background-image':g.image,'background-position':g.pos});i&&i();}});};b.ui.addComboButton('Transformations',{label:b.lang.transformations.label,title:b.lang.transformations.panelTitle,className:'cke_transformations',icon:b.config.mindtouch.editorPath+'/images/icons.png',iconOffset:11,modes:{},panel:{css:b.skin.editor.css.concat(c.contentsCss),multiSelect:false,attributes:{'aria-label':b.lang.panelTitle}},init:function(){var i=this;h(function(){var j;i.startGroup(b.lang.transformations.panelTitle);j=b.lang.list.none;i.add('none','<span>'+j+'</span>',j);for(var k in d){var l=d[k],m=l.attributes['function'];j=m.length?m:l.title;i.add(k,'<span>'+j+'</span>',j);}i.commit();i.onOpen();b.selectionChange();});},onClick:function(i){var o=this;b.focus();b.fire('saveSnapshot');var j=d[i],k=b.getSelection();if(!k)return;var l=new CKEDITOR.dom.elementPath(k.getStartElement());if(i=='none')j=d[o.getValue()];if(j&&j.isActive(l)){j.remove(l);o.setState(2);}else{var m=d[o.getValue()];m&&m.remove(l);j.apply(l);o.setState(1);}var n=o._.list;try{n.element.getDocument().getById(n._.items[i]).getFirst().$.blur();}catch(p){}b.fire('saveSnapshot');},onRender:function(){b.on('selectionChange',function(i){var j=i.data.path,k=function(){var o=this;var l=0;for(var m in d){var n=d[m];if(n.isApplicable(j)){if(n.isActive(j)){if(m!=o.getValue())o.setValue(m);o.setState(1);return;}l=2;}}o.setValue('none');o.setState(l);};k.call(this);},this);},onOpen:function(){var n=this;if(CKEDITOR.env.ie)b.focus();var i=b.getSelection();if(!i)return;var j=i.getSelectedElement(),k=new CKEDITOR.dom.elementPath(j||i.getStartElement());n.showAll();n.unmarkAll();n.mark('none');for(var l in d){var m=d[l];if(m.isApplicable(k)){if(m.isActive(k))n.mark(l);}else n.hideItem(l);}}});b.on('instanceReady',h);}});})();CKEDITOR.plugins.add('infopanel',{});CKEDITOR.ui.infoPanel=function(a,b){var c=this;if(b)CKEDITOR.tools.extend(c,b);CKEDITOR.tools.extend(c,{hasClose:false});
c.className=c.className||'';c.className+=c.className.length?' cke_infopanel':'cke_infopanel';c.document=a;c._={groups:{},groupsList:[]};};CKEDITOR.ui.infoPanel.prototype={renderHtml:function(a){var b=[];this.render(a,b);return b.join('');},render:function(a,b){var c=this._.id=CKEDITOR.tools.getNextId();b.push('<div style="display:none;" class="'+this.className+'" role="presentation" id="'+c+'">');if(this.hasClose){var d=CKEDITOR.tools.addFunction(function(){this.hide();},this);b.push('<a id="'+c+'_close"'+' class="close_button" href="javascript:void(0)"'+' onclick="CKEDITOR.tools.callFunction(',d,', this); return false;" title="'+a.lang.common.close+'" role="button"><span class="cke_label">X</span></a>');}b.push('</div>');return this;},getContainer:function(){return this.document.getById(this._.id);},addGroup:function(a,b){b=b||10;var c=this.document,d=new CKEDITOR.dom.element('div',c);d.addClass('cke_infopanel_group');d.setStyle('display','none');var e={name:a,element:d,priority:b,visible:false,labels:{}};this._.groups[a]=e;this._.groupsList.push(e);this._.groupsList.sort(function(h,i){return h.priority<i.priority?-1:h.priority>i.priority?1:0;});for(var f=0,g=this._.groupsList.length;f<g;f++){if(this._.groupsList[f].name==a){if(f==0&&this._.groupsList.length==1){if(this.hasClose)d.insertBefore(c.getById(this._.id+'_close'));else this.getContainer().append(d);}else if(f==0)d.insertBefore(this._.groupsList[1].element);else d.insertAfter(this._.groupsList[f-1].element);break;}}return this;},showGroup:function(a){var b=this;if(b._.groups[a]){b.show();b._.groups[a].element.setStyle('display','');b._.groups[a].visible=true;b.updateGroupDelimiters();}return b;},hideGroup:function(a){var d=this;if(d._.groups[a]){d._.groups[a].element.setStyle('display','none');d._.groups[a].visible=false;d.updateGroupDelimiters();var b=true;for(var c in d._.groups){if(d._.groups[c].visible){b=false;break;}}b&&d.hide();}return d;},addLabel:function(a,b,c){var e=this;if(!e._.groups[a])throw 'Group "'+a+'" does not exist.';var d=new CKEDITOR.dom.element('span',e.document);e._.groups[a].element.append(d);e._.groups[a].labels[b]=d;if(c)e.updateLabel(b,a,c);return e;},getLabelElement:function(a,b){if(!this._.groups[a])throw 'Group "'+a+'" does not exist.';return this._.groups[a].labels[b]||null;},updateLabel:function(a,b,c){this._.groups[a]&&this._.groups[a].labels[b]&&this._.groups[a].labels[b].setHtml(c);},show:function(){this.getContainer().setStyle('display','');return this;},hide:function(){var a=this;
if(typeof a.onHide==='function'&&a.onHide.call(a))return a;a.getContainer().setStyle('display','none');return a;},updateGroupDelimiters:function(){var a=false;for(var b=this._.groupsList.length-1;b>=0;b--){var c=this._.groupsList[b];if(this._.groups[c.name].visible&&!a)c.element.setStyle('margin-right','-1px');else c.element.setStyle('margin-right','');}}};CKEDITOR.plugins.add('infobar',{requires:['infopanel'],init:function(a){a.ui.infobar=new CKEDITOR.ui.infoPanel(CKEDITOR.document,{className:'cke_infobar'});a.on('themeSpace',function(b){if(b.data.space=='top')b.data.html+=a.ui.infobar.renderHtml(b.editor);});a.on('contentDom',function(){a.document.getBody().addClass('infobar_enabled');});a.on('mode',function(){if(a.mode=='source')a.textarea&&a.textarea.addClass('infobar_enabled');});}});(function(){function a(d){var e=d.getSelection(),f=e&&e.getStartElement(),g=f&&new CKEDITOR.dom.elementPath(f);if(!g||!g.block||!g.block.is('pre')){d.ui.infobar.hideGroup('dekiscript');return;}var h=e.getRanges()[0],i=h&&h.startContainer,j={lines:1,chars:0},k=function(n){var o;if(n.type==3){o=n.getText();if(!CKEDITOR.env.gecko){var p,q;if(CKEDITOR.env.ie){p='\r';q=/(^\r)|(\r$)/;}if(CKEDITOR.env.webkit){p='\n';q=/(^\n)|(\n$)/;}if(CKEDITOR.env.opera){p='\r\n';q=/(^\r\n)|(\r\n$)/;}var r=o.split(p);switch(r.length){case 1:if(j.lines<2)j.chars+=o.length;break;case 2:if(q.test(o)){if(j.lines<2)j.chars+=r[r.length-1].length;j.lines++;break;}default:if(j.lines<2)j.chars+=r[r.length-1].length;j.lines+=r.length-1;break;}return;}if(j.lines<2)j.chars+=o.length;}else if(n.type==1)if(n.is('br'))j.lines++;else if(j.lines<2)j.chars+=n.getText().length;};if(i&&i.is&&i.is('pre')&&h.collapsed){var l=d.document.createElement('span');l.setHtml('&#65279;');h.insertNode(l);i=l.getPreviousSourceNode(true,null,h.startContainer);i&&k(i);l.remove();}else if(i&&i.type==3){text=i.getText().substring(0,h.startOffset);var m=new CKEDITOR.dom.text(text);k(m);}else if(i)k(i);if(i)while(i=i.getPreviousSourceNode(true,null,g.block))k(i);c(d,j.lines,j.chars);d.ui.infobar.showGroup('dekiscript');};function b(d){var e=d.editor||d.listenerData;CKEDITOR.tools.setTimeout(a,0,this,e);};function c(d,e,f){d.ui.infobar.updateLabel('dekiscript','line',d.lang.dsbar.line+':&nbsp;'+e+',&nbsp;');d.ui.infobar.updateLabel('dekiscript','col',d.lang.dsbar.col+':&nbsp;'+f);};CKEDITOR.plugins.add('dsbar',{requires:['infobar','selection'],init:function(d){d.on('contentDom',function(){d.document.on('mouseup',b,this,d);d.document.on('keyup',b,this,d);
});d.on('mode',b);d.on('selectionChange',b);d.on('themeLoaded',function(){d.ui.infobar.addGroup('dekiscript');d.ui.infobar.addLabel('dekiscript','line');d.ui.infobar.addLabel('dekiscript','col');});},afterInit:function(d){var e=d.dataProcessor,f=e&&e.dataFilter;if(CKEDITOR.env.gecko&&f)f.addRules({elements:{pre:function(g){var h=new CKEDITOR.dom.element('br',d.document),i=function(j){if(!j.children)return;for(var k=0;k<j.children.length;k++){var l=j.children[k];if(l.type==3)l.value=l.value.replace(/\n/g,h.getOuterHtml());else i(l);}};i(g);}}});}});})();(function(){function a(c){return c.fire('checkDirty',{isDirty:false}).isDirty;};var b=CKEDITOR.tools.createClass({$:function(c){var d=this;d.editor=c;d.storage=null;d.params={};if(d.editor.config.mindtouch.pageId>0)d.key='cke_'+d.editor.config.mindtouch.pageId;else d.key='cke_'+encodeURIComponent(d.editor.config.mindtouch.pageTitle);d.initStorage();d.addUnloadHandler();},proto:{initStorage:function(){if(window.localStorage)try{window.localStorage.setItem('cke_test','test');if(window.localStorage.getItem('cke_test')==='test'){window.localStorage.removeItem('cke_test');this.storage=window.localStorage;}}catch(c){}},addUnloadHandler:function(){if(this.storage&&jQuery){var c=this;this.removeUnloadHandler();$(window).bind('beforeunload.editor',function(){if(a(c.editor))c.save();});}},removeUnloadHandler:function(){if(this.storage&&jQuery)$(window).unbind('beforeunload.editor');},save:function(){var c=this;if(c.storage){c.storage.setItem(c.key,c.editor.getData());c.saveParam('timestamp',new Date().getTime());c.editor.fire('draftSaved');return true;}return false;},saveParam:function(c,d){var e=this;if(e.storage){e.storage.setItem(e.key+'_'+c,d);e.params[c]=d;e.editor.fire('paramSaved',{name:c});return true;}return false;},getParam:function(c){var e=this;var d=e.params[c]||null;if(e.storage&&!d){d=e.storage.getItem(e.key+'_'+c);if(d)e.params[c]=d;}return d;},getTimestamp:function(){var c=this.getParam('timestamp');if(c)c=parseInt(c);return c;},load:function(){if(this.storage){var c=this.storage.getItem(this.key);if(c)this.editor.setData(c,function(){this.fire('draftLoaded');});return true;}return false;},isExists:function(){if(this.storage)return!!this.storage.getItem(this.key);return false;},remove:function(){var d=this;if(d.storage){d.storage.removeItem(d.key);for(var c in d.params)d.storage.removeItem(d.key+'_'+c);d.editor.fire('draftRemoved');return true;}return false;}}});CKEDITOR.plugins.add('autosave',{requires:['infobar','infopanel'],init:function(c){if(c.config.mindtouch.isReadOnly||c.config.mindtouch.sectionId||c.config.mindtouch.userIsAnonymous)return;
var d=new b(c);if(!d.storage)return;var e=c.lang.autosave,f,g,h,i=new CKEDITOR.ui.infoPanel(CKEDITOR.document,{className:'cke_autosavepanel',onHide:function(){if(jQuery){jQuery(this.getContainer().$).fadeOut(200);return true;}return false;}}),j=function(){if(a(c)){var q=c.getSnapshot();if(Math.abs(q.length-f.length)>c.config.autosave_minLength)if(d.save())f=q;}};g=window.setInterval(j,c.config.autosave_interval*1000);c.on('saveSnapshot',j,null,null,100);var k=function(q){var r=q.getHours(),s=q.getMinutes(),t='';if(c.config.autosave_timeFormat=='24H')r=r<10?'0'+r:r;else{if(r>11){r-=12;t=' PM';}else t=' AM';if(r===0)r=12;}s=s<10?'0'+s:s;return r+':'+s+t;},l=function(q){var r=q.getMonth()+1,s=q.getDate(),t=q.getFullYear();r=r<10?'0'+r:r;s=s<10?'0'+s:s;var u=c.config.autosave_dateFormat.replace('%m',r).replace('%d',s).replace('%y',t);return u;},m=function(){var q=new Date().getTime()-d.getTimestamp(),r=q/1000,s=r/60,t=s/60,u=t/24,v=u/365,w=r<45&&e.timeago.seconds||r<90&&e.timeago.minute||s<45&&e.timeago.minutes.replace('%1',Math.round(s))||s<90&&e.timeago.hour||t<24&&e.timeago.hours.replace('%1',Math.round(t))||t<48&&e.timeago.day||u<30&&e.timeago.days.replace('%1',Math.floor(u))||u<60&&e.timeago.month||u<365&&e.timeago.months.replace('%1',Math.floor(u/30))||v<2&&e.timeago.year||e.timeago.years.replace('%1',Math.floor(v));w=' ('+w+' '+e.timeago.suffixAgo+')';return w;},n=function(q){c.ui.infobar.updateLabel('autosave','timeAgo',q);c.ui.infobar.showGroup('autosave');h&&window.clearInterval(h);h=window.setInterval(function(){c.ui.infobar.updateLabel('autosave','timeAgo',e.localSave+m());},15000);},o=function(){window.clearInterval(g);h&&window.clearInterval(h);},p=function(){o();d.remove();d.removeUnloadHandler();};c.on('save',p);c.on('cancel',p);c.on('destroy',function(q){o();});c.on('instanceReady',function(q){if(d.isExists()){var r=c.getData();d.load();var s,t,u;s=function(){c.removeListener('focus',s);CKEDITOR.document.removeListener('keydown',u);i.hide();n(e.localSave+m());c.focus();};t=function(){c.removeListener('focus',s);CKEDITOR.document.removeListener('keydown',u);c.setData(r,function(){c.resetDirty();d.remove();i.hide();c.focus();});};u=function(G){if(G.data.getKeystroke()==27)setTimeout(t,0);};var v=CKEDITOR.tools.addFunction(s),w=CKEDITOR.tools.addFunction(t);c.on('destroy',function(G){CKEDITOR.tools.removeFunction(v);CKEDITOR.tools.removeFunction(w);});var x=new Date(d.getTimestamp()),y=parseInt(c.config.mindtouch.pageRevision),z=parseInt(d.getParam('pageRevision')),A=e.continueEditing,B=e.discardChanges,C='',D;
if(y>z){D=e.draftOutdated.replace('%1',z).replace('%2',y);A=e.editVersion.replace('%1',z);B=e.editVersion.replace('%1',y);C='<span class="delimiter">'+e.or+'</span>';i.getContainer().addClass('cke_autosave_outdated');}else D=e.draftExists.replace('%1',l(x)).replace('%2',k(x));var E='<a href="javascript:void(0)" onclick="CKEDITOR.tools.callFunction('+v+'); return false;"'+'>'+A+'</a>',F='<a href="javascript:void(0)" onclick="CKEDITOR.tools.callFunction('+w+'); return false;"'+'>'+B+'</a>';i.updateLabel('draft','notification',D);i.updateLabel('draft','links',E+C+F);i.showGroup('draft');c.focusManager.blur();i.getLabelElement('draft','links').getFirst().focus();c.on('focus',s);CKEDITOR.document.on('keydown',u);}});c.on('dataReady',function(){setTimeout(function(){f=c.getSnapshot();},0);});c.on('draftSaved',function(){d.saveParam('pageRevision',c.config.mindtouch.pageRevision);n(e.localSave+' ('+e.timeago.justNow+')');});c.on('themeSpace',function(q){if(q.data.space=='top')q.data.html+=i.renderHtml(q.editor);});c.on('themeLoaded',function(){var q=c.ui.infobar;q.addGroup('autosave',1);q.addLabel('autosave','timeAgo');i.addGroup('draft');i.addLabel('draft','notification');i.addLabel('draft','links');});c.on('checkDirty',function(q){q.data.isDirty=c.checkDirty();q.stop();},null,null,100);}});})();CKEDITOR.config.autosave_interval=25;CKEDITOR.config.autosave_minLength=20;CKEDITOR.config.autosave_dateFormat='%m/%d/%y';CKEDITOR.config.autosave_timeFormat='12H';(function(){var a='video',b={canUndo:false,exec:function(c){this.editor=c;var d=CKEDITOR.plugins.get('mindtouchdialog');d.openDialog(c,a,{url:c.config.mindtouch.commonPath+'/popups/popup-video.php',width:'400px',height:'auto',params:null,callback:this._.insertVideo,scope:this});},_:{insertVideo:function(c){var d=this.editor;if(c.f_content){var e=['source: "'+c.f_content+'"'];if(c.f_width.length)e.push('width: "'+c.f_width+'"');else if(c.f_height.length)e.push('width: nil');if(c.f_height.length)e.push('height: "'+c.f_height+'"');d.insertHtml('{{ media{ '+e.join(', ')+' } }}');}}}};CKEDITOR.plugins.add(a,{requires:['mindtouchdialog'],init:function(c){c.addCommand(a,b);c.ui.addButton('Video',{label:c.lang.video.toolbar,command:a,icon:c.config.mindtouch.editorPath+'/images/icons.png',iconOffset:10});}});})();(function(){var a=(function(){var h=CKEDITOR.tools.extend({},CKEDITOR.dtd.$blockLimit);delete h.div;delete h.td;delete h.th;return h;})(),b=CKEDITOR.dtd.div;function c(h,i,j){if(!i.is||!i.getCustomData('block_processed')){i.is&&CKEDITOR.dom.element.setMarker(j,i,'block_processed',true);
h.push(i);}};function d(h){var i=new CKEDITOR.dom.elementPath(h).elements,j;for(var k=0;k<i.length;k++){if(i[k].getName() in a){j=i[k];break;}}return j;};function e(h){var i=[],j=null,k,l;for(var m=0;m<h.length;m++){l=h[m];var n=d(l);if(!n.equals(j)){j=n;i.push([]);}i[i.length-1].push(l);}return i;};function f(h){var i=[],j={},k=[],l,m=h.document.getSelection(),n=m.getRanges(),o=m.createBookmarks(),p,q;for(p=0;p<n.length;p++){q=n[p].createIterator();while(l=q.getNextParagraph()){if(l.getName() in a){var r,s=l.getChildren();for(r=0;r<s.count();r++)c(k,s.getItem(r),j);}else{while(!b[l.getName()]&&l.getName()!='body')l=l.getParent();c(k,l,j);}}}CKEDITOR.dom.element.clearAllMarkers(j);var t=e(k),u,v;for(p=0;p<t.length;p++){var w=t[p][0];u=w.getParent();for(r=1;r<t[p].length;r++)u=u.getCommonAncestor(t[p][r]);v=new CKEDITOR.dom.element('div',h.document);for(r=0;r<t[p].length;r++){w=t[p][r];while(!w.getParent().equals(u))w=w.getParent();t[p][r]=w;}for(r=0;r<t[p].length;r++){w=t[p][r];if(!(w.getCustomData&&w.getCustomData('block_processed'))){w.is&&CKEDITOR.dom.element.setMarker(j,w,'block_processed',true);if(!r)v.insertBefore(w);v.append(w);}}CKEDITOR.dom.element.clearAllMarkers(j);i.push(v);}m.selectBookmarks(o);return i;};var g=[];CKEDITOR.plugins.add('wrapstyle',{requires:['styles'],beforeInit:function(h){var i=function(n,o){return n.wrap===true?-1:o.wrap===true?1:0;};h.getStylesSet(function(n){for(var o=0,p=n.length;o<p;o++){var q=n[o],r,s;if(q.wrap&&q.wrap===true&&q.attributes){s=q.attributes['class']||'';if(s.length)s+=' ';s+=h.config.style_wrap_class||'style-wrap';q.attributes['class']=s;r=new CKEDITOR.style(q);g.push(r);}}n.sort(i);});var j=CKEDITOR.style.prototype,k=j.apply,l=j.remove,m=j.checkElementRemovable;CKEDITOR.tools.extend(j,{apply:function(n){var o=this;if(o._.definition.wrap&&o._.definition.wrap===true)h.execCommand('wrapstyle',o);else k.apply(o,arguments);},remove:function(n){var o=this;if(o._.definition.wrap&&o._.definition.wrap===true)h.execCommand('wrapstyle',o);else l.apply(o,arguments);},checkElementRemovable:function(n,o){var p=this;if(p._.definition.wrap&&p._.definition.wrap===true)n=n&&n.getAscendant(p.element,true);return m.apply(p,[n,o]);}},true);},init:function(h){h.addCommand('wrapstyle',{exec:function(i,j){var k=i.getSelection(),l=k&&k.createBookmarks(),m=k&&k.getRanges(),n=m&&m.createIterator(),o,p,q,r=true,s=[];while(o=n.getNextRange()){p=o.createIterator();p.enforceRealBlocks=true;var t;while(t=p.getNextParagraph()){q=t.getAscendant(j.element,true);
if(q&&j.checkElementRemovable(q)){var u=s.pop(),v=u&&u.getCommonAncestor(q);if(v&&j.checkElementRemovable(v))s.push(v);else{u&&s.push(u);s.push(q);}}else if(s.length==0)r=false;}}if(r)for(var w=0,x=s.length;w<x;w++)s[w].remove(true);else{var y=f(i);for(var w=0,x=y.length;w<x;w++){q=y[w];j.applyToObject(q);}}l&&k.selectBookmarks(l);}});},afterInit:function(h){h.addRemoveFormatFilter&&h.addRemoveFormatFilter(function(i){for(var j=0,k=g.length;j<k;j++){var l=g[j];if(i.is(l.element)&&l.checkElementRemovable(i))return false;}return true;});}});})();(function(){var a={},b={},c={};function d(l){return l.type==3&&l.getLength()>0;};function e(l){return l&&l.getName&&l.getName()=='span'&&l.data('atd-error-id');};var f=function(){this.positions=[];this.errors=[];};f.prototype={add:function(l,m){if(!this.errors[l]){this.positions.push(l);this.errors[l]=m;}},hasPos:function(l){return typeof this.errors[l]=='object';},count:function(){return this.positions.length;},each:function(l,m){if(typeof l!='function')return;m=m||this;var n=this.positions.sort(function(q,r){return q-r;});for(var o=0;o<n.length;o++){var p=this.errors[n[o]];l.apply(m,[n[o],p]);}}};var g={getHash:function(l){var m=this.get(l),n={};if(m)jQuery.each(m.split('&'),function(o,p){p=p.split('=');n[unescape(p[0])]=unescape(p[1]);});return n;},setHash:function(l,m,n){var o='';jQuery.each(m,function(p,q){o+=(!o?'':'&')+escape(p)+'='+escape(q);});this.set(l,o,n);},set:function(l,m,n){var o='';if(n){var p=new Date();p.setTime(p.getTime()+n*24*60*60*1000);o='; expires='+p.toGMTString();}document.cookie=l+'='+escape(m)+o+'; path=/';},get:function(l){var m=l+'=',n=document.cookie.split(';');for(var o=0;o<n.length;o++){var p=n[o];while(p.charAt(0)==' ')p=p.substring(1,p.length);if(p.indexOf(m)==0)return unescape(p.substring(m.length,p.length));}return null;},remove:function(l){g.set(l,'',-1);}},h=function(l){var m=null,n=(l||'').replace(/&nbsp;/g,'\xa0');if(window.DOMParser)m=new DOMParser().parseFromString(n,'text/xml');else if(window.ActiveXObject){try{m=new ActiveXObject('MSXML2.DOMDocument');}catch(o){try{m=new ActiveXObject('Microsoft.XmlDom');}catch(o){}}if(m){m.async=false;m.resolveExternals=false;m.validateOnParse=false;m.loadXML(n);}}return m;},i=function(l){var m='',n,o="\"'s!#$%&()*+,./:;<=>?@[]^_{|}";for(n=0;n<o.length;n++)m+='\\'+o.charAt(n);if(l)return '(?:[^\xa0'+m+'])+';else return '(?:(?:[\xa0'+m+'])|(?:\\-\\-))+';},j={elements:{span:function(l){if(l.attributes['data-atd-error-id']){delete l.name;return l;
}}}},k={canUndo:false,editorFocus:true,exec:function(l){this.editor=l;var m=this,n=l.getSelection(),o=l.config.atd_rpc_url;o+=o.indexOf('?')==-1?'?':'&';o+='url=/checkDocument&lang='+(l.langCode||'en');if(l.lock){l.lock();n&&n.lock();}jQuery.ajax({url:o,data:{data:l.getData()},type:'POST',dataType:'json',success:function(p,q){if(q=='success'&&p.success===true)try{m._processErrors.call(m,p.body);}catch(r){if(l.unlock){l.unlock();n&&n.unlock();}throw r;}else alert(l.lang.atd.serverError);},error:function(p,q,r){alert(l.lang.atd.serverError);},complete:function(){if(l.unlock){l.unlock();n&&n.unlock();}}});},_processErrors:function(l){var m=this,n=this.editor,o=h(l);if(!o)throw 'Unable to parse result XML';var p=jQuery(o),q=p.children('message');if(q.length){alert(q.text());return;}this._clearErrors();a={};var r=p.find('results > error');if(r.length==0){alert(n.lang.atd.noErrors);return;}var s=function(F){var G=F.data.getTarget();if(e(G)&&!G.isReadOnly())m._showMenu.call(m,G);};n.document.removeListener('click',s);n.document.on('click',s);var t,u;t=new CKEDITOR.dom.range(n.document);t.setStartBefore(n.document.getBody());t.setEndAfter(n.document.getBody());u=new CKEDITOR.dom.walker(t.clone());u.evaluator=d;var v,w;while(v=u.next()){if(w&&w.getParent().equals(v.getParent())&&v.getPrevious().equals(w)){var x=w.getText()+v.getText(),y=new CKEDITOR.dom.text(x,n.document);y.insertAfter(v);w.remove();v.remove();v=y;var z=new CKEDITOR.dom.range(n.document);z.moveToPosition(v,4);z.setEndAfter(n.document.getBody());u.range=z;u.reset();}w=v;}u=new CKEDITOR.dom.walker(t.clone());u.evaluator=d;while(v=u.next()){var A=new f(),x=v.getText();r.each(function(){var F=jQuery(this),G=F.children('string').text(),H=F.children('description').text();if(b[G]||c[H])return;var I=x.indexOf(G);while(I>-1&&(A.hasPos(I)||!m._checkErrorPrecontext(F,x,I)))I=x.indexOf(G,I+G.length);if(I>-1)A.add(I,F);});if(A.count()==0)continue;var B=[],C=x,D=0;A.each(function(F,G){F-=D;var H=C.substring(0,F),I=G.children('string').text(),J=m._createErrorNode(G);B.push(new CKEDITOR.dom.text(H,n.document));B.push(J);C=C.substring(F+I.length);D=F+D+I.length;});if(C.length)B.push(new CKEDITOR.dom.text(C,n.document));var z=new CKEDITOR.dom.range(n.document);z.selectNodeContents(v);z.deleteContents();for(var E=0;E<B.length;E++){z.insertNode(B[E]);z.moveToPosition(B[E],4);}z.setEndAfter(n.document.getBody());u.range=z;u.reset();}n.fire('scrollToTop');},_createErrorNode:function(l){var m=this.editor,n=l.children('string').text(),o=l.children('type').text().toLowerCase(),p=new CKEDITOR.dom.element('span',m.document);
p.setText(n);var q=new CKEDITOR.style(m.config.atd_styles[o]);q.applyToObject(p);var r=CKEDITOR.tools.getNextNumber();p.data('atd-error-id',r);a[r]=l;return p;},_checkErrorPrecontext:function(l,m,n){var o=l.children('precontext').text(),p=m.substring(0,n),q,r,s=false;if(o.length){q=new RegExp('(?:^|'+i()+')('+i(true)+')'+i()+'$');r=q.exec(p);if(r&&r[1]==o)s=true;}else{q=new RegExp('(?:^|.*?'+i()+')'+l.children('string').text()+'(?:'+i()+'|$)');r=q.exec(m);if(r)s=true;}return s;},_showMenu:function(l){var m=this.editor,n=this,o=this._menu,p=this._suggestions=this._suggestions||{};if(!o){m.addMenuGroup('atdTitle',100);m.addMenuGroup('atdSuggestion',200);m.addMenuGroup('atdExplain',300);m.addMenuGroup('atdIgnore',400);o=this._menu=new CKEDITOR.menu(m);o.addListener(function(q,r){var s=a[q.data('atd-error-id')];if(!s)return{};var t=new CKEDITOR.dom.range(m.document);t.selectNodeContents(q);t.select();var u=function(z){if(z){t.selectNodeContents(z);t.collapse();t.select();}};for(var v in p)delete m._.menuItems[v];p={};var w=new CKEDITOR.menuTitle(m,'atd_title',{title:s.children('description').text(),group:'atdTitle'});m._.menuItems.atd_title=w;p.atd_title=2;s.children('suggestions').children('option').each(function(){var z=jQuery(this);m.addMenuItem('atd_suggestion',{label:z.text(),group:'atdSuggestion',suggestion:z.text(),onClick:function(){m.focus();m.fire('saveSnapshot');if(this.suggestion=='(omit)'){u(q);q.remove();}else{var A=new CKEDITOR.dom.text(this.suggestion,m.document);A.replace(q);u(A);}m.fire('saveSnapshot');}});p.atd_suggestion=2;});var x=s.children('url');if(x.length){m.addMenuItem('atd_explain',{label:m.lang.atd.explain,group:'atdExplain',onClick:function(){window.open(x.text()+'&theme='+m.config.atd_theme,'atdExplain','location=1,toolbar=0,menubar=0,directories=0,resizable=1,status=0,scrollbars=1,width=480,height=380');}});p.atd_explain=2;}m.addMenuItem('atd_ignore',{label:m.lang.atd.ignoreSuggestion,group:'atdIgnore',onClick:function(){m.focus();var z=q.getFirst();q.remove(true);u(z);}});p.atd_ignore=2;var y=function(){m.focus();var z=q.getFirst(),A=q.getText();n._clearErrors(A);u(z);if(this.name=='atd_ignoreAlways'){var B=m.config.atd_ignore_rpc_url||'';if(B.length)jQuery.ajax({url:B+encodeURI(A).replace(/&/g,'%26'),type:'GET',dataType:'xml',success:function(D,E){if(E!='success')alert('Ignore preference save failed\n'+E+'\nAt: '+B);},error:function(D,E,F){alert('Ignore preference save failed\n'+E+'\nAt: '+B);}});else{var C=g.getHash('atd_ignore')||{};
C[A]=1;g.setHash('atd_ignore',C,365);}b[A]=1;}};if(m.config.atd_ignore_enable){m.addMenuItem('atd_ignoreAlways',{label:m.lang.atd.ignoreAlways,group:'atdIgnore',onClick:y});p.atd_ignoreAlways=2;}else{m.addMenuItem('atd_ignoreAll',{label:m.lang.atd.ignoreAll,group:'atdIgnore',onClick:y});p.atd_ignoreAll=2;}return p;});}o.show(l,4);},_clearErrors:function(l){var m=this.editor.document.getElementsByTag('span'),n=m.count(),o,p;for(o=n-1;o>=0;o--){p=m.getItem(o);if(e(p))if(!l||l==p.getText())p.remove(true);}}};CKEDITOR.menuTitle=CKEDITOR.tools.createClass({$:function(l,m,n){var o=this;CKEDITOR.tools.extend(o,n);o.group=l._.menuGroups[o.group];o.editor=l;o.name=m;},proto:{render:function(l,m,n){var q=this;var o=l.id+String(m),p=typeof q.state=='undefined'?2:q.state;n.push('<span class="cke_menuitem"><span id="',o,'" class=cke_menu_title"','" href="javascript:void(\'',(q.title||'').replace("'",''),'\')" title="',q.title,'" tabindex="-1" _cke_focus=1 hidefocus="true" role="menuitem"'+(p==0?'aria-disabled="true"':'')+(p==1?'aria-pressed="true"':''));if(CKEDITOR.env.opera||CKEDITOR.env.gecko&&CKEDITOR.env.mac)n.push(' onkeypress="return false;"');if(CKEDITOR.env.gecko)n.push(' onblur="this.style.cssText = this.style.cssText;"');n.push('><span class="cke_label" style="margin-left:0; text-align:center; font-weight:bold;">');if(q.getItems)n.push('<span class="cke_menuarrow"></span>');n.push(q.title,'</span></span></span>');}}});CKEDITOR.plugins.add('atdspellchecker',{beforeInit:function(){if(typeof jQuery=='undefined')CKEDITOR.scriptLoader.load('http://code.jquery.com/jquery-latest.js');},init:function(l){l.addCommand('atdCheckSpell',k);var m={label:l.lang.atd.toolbar,command:'atdCheckSpell'};if(!m.icon){m.icon=l.config.mindtouch.editorPath+'/images/icons.png';m.iconOffset=2;}l.ui.addButton('ATDSpellChecker',m);var n=l.dataProcessor,o=n&&n.htmlFilter;o&&o.addRules(j);var p=l.config.atd_ignore_strings||'';p=p.split(/,\s*/g);for(var q=0;q<p.length;q++)b[p[q]]=1;if(l.config.atd_ignore_enable){var r=g.getHash('atd_ignore')||{};CKEDITOR.tools.extend(b,r);}var s=Deki.atdIgnoreTypes||l.config.atd_ignore_types||'';s=s.split(/,\s*/g);for(var q=0;q<s.length;q++)c[s[q]]=1;},afterInit:function(l){var m;if(l._.elementsPath&&(m=l._.elementsPath.filters))m.push(function(n){if(e(n))return false;});}});})();CKEDITOR.config.atd_styles={spelling:{element:'span',styles:{'border-bottom':'2px solid red'},attributes:{'class':'atdError'}},grammar:{element:'span',styles:{'border-bottom':'2px solid green'},attributes:{'class':'atdError'}},suggestion:{element:'span',styles:{'border-bottom':'2px solid blue'},attributes:{'class':'atdError'}}};
CKEDITOR.config.atd_rpc_url=Deki.Plugin.AJAX_URL+'?formatter=atdspellchecker';CKEDITOR.config.atd_theme='tinymce';CKEDITOR.config.atd_ignore_types='Bias Language,Cliches,Complex Expression,Diacritical Marks,Double Negatives,Hidden Verbs,Jargon Language,Passive voice,Phrases to Avoid,Redundant Expression';CKEDITOR.config.atd_ignore_strings='';CKEDITOR.config.atd_ignore_enable=false;(function(){var a='attachimage';function b(f){if(f.config.mindtouch.pageId==0)return 0;return 2;};function c(f){var g=f.editor,h=g.getCommand(a);h.state=b(g);h.fire('state');};function d(f){var g=document.location.protocol+'//'+document.location.host;if(f.indexOf(g)==0)f=f.substring(g.length);return f;};var e={canUndo:false,exec:function(f){var g={titleID:f.config.mindtouch.pageId,commonPath:f.config.mindtouch.commonPath},h=CKEDITOR.plugins.get('mindtouchdialog');h&&h.openDialog(f,a,{url:g.commonPath+'/popups/attach_dialog.php?filter=images',width:'650px',height:'auto',params:g,callback:this._.insertImages,scope:f});return true;},_:{insertImages:function(f){var g=this,h=[],i;for(i=0;i<f.length;i++){if(f[i]!==false)h.push(f[i]);}var j={fileIds:h.join(',')};Deki.$.get('/deki/gui/attachments.php?action=getbyids',j,function(k){if(CKEDITOR.tools.isArray(k)){for(i=0;i<k.length;i++){var l=k[i];if(!l.href)continue;var m=g.document.createElement('p');g.insertElement(m);var n=null;if(l.width&&l.height){n=g.document.createElement('img');n.setAttribute('src',d(l.href));n.setStyle('width',l.width+'px');n.setStyle('height',l.height+'px');n.setAttribute('alt','');}else{n=g.document.createElement('a');var o=d(l.href);n.setAttribute('href',o);n.setAttribute('title',o);n.setHtml(o);}n.addClass('internal');n.appendTo(m);}if(Deki.Plugin&&Deki.Plugin.FilesTable)Deki.Plugin.FilesTable.Refresh(g.config.mindtouch.pageId);}},'json');}}};CKEDITOR.plugins.add(a,{init:function(f){f.addCommand(a,e);f.ui.addButton('AttachImage',{label:f.lang.attachImage,command:a,icon:f.config.mindtouch.editorPath+'/images/icons.png',iconOffset:3});f.on('selectionChange',c);}});})();(function(){var a={exec:function(b){var c=b.getSelection(),d=c&&c.getRanges(true)[0];if(!d)return;b.fire('saveSnapshot');var e=d.createIterator(),f,g,h=[];while(g=e.getNextParagraph())h.push(g);if(h.length&&h[h.length-1].hasNext())f=h[h.length-1].getNext();var i=b.document.createElement('table');i.setAttribute('cellSpacing',1);i.setAttribute('cellPadding',1);i.setAttribute('border',1);if(f)i.insertBefore(f);else b.document.getBody().append(i);var j,k,l=[];
c.reset();for(j=0;j<h.length;j++){k=new CKEDITOR.dom.element(i.$.insertRow(-1).insertCell(-1));k.setHtml(h[j].remove().getHtml());d=new CKEDITOR.dom.range(b.document);d.setStartAt(k,1);d.setEndAt(k,2);l.push(d);}c.selectRanges(l);setTimeout(function(){b.fire('saveSnapshot');},0);b.selectionChange();b.focus();},canUndo:false};CKEDITOR.plugins.add('tableconvert',{init:function(b){b.addCommand('tableToText',new CKEDITOR.dialogCommand('tableToText'));b.addCommand('textToTable',a);CKEDITOR.dialog.add('tableToText',this.path+'dialogs/totext.js');if(b.addMenuItems)b.addMenuItems({tabletotext:{label:b.lang.tableconvert.toText,command:'tableToText',group:'table',order:3},texttotable:{label:b.lang.tableconvert.toTable,command:'textToTable',group:'table',order:3}});if(b.contextMenu)b.contextMenu.addListener(function(c,d){if(!c||c.isReadOnly())return null;var e=c.is('table')||c.hasAscendant('table');if(e)return{tabletotext:2};return{texttotable:2};});}});})();CKEDITOR.plugins.add('tablesort',{init:function(a){var b=a.lang.tablesort;a.addCommand('tablesort',new CKEDITOR.dialogCommand('tablesort'));CKEDITOR.dialog.add('tablesort',this.path+'dialogs/sort.js');if(a.addMenuItems)a.addMenuItems({tablesort:{label:b.menu,command:'tablesort',group:'table',order:2}});if(a.contextMenu)a.contextMenu.addListener(function(c,d){if(!c||c.isReadOnly())return null;var e=c.is('table')||c.hasAscendant('table');if(e)return{tablesort:2};return null;});}});CKEDITOR.themes.add('mindtouch',(function(){function a(b,c){var d,e;e=b.config.sharedSpaces;e=e&&e[c];e=e&&CKEDITOR.document.getById(e);if(e){var f='<span class="cke_shared " dir="'+b.lang.dir+'"'+'>'+'<span class="'+b.skinClass+' '+b.id+' cke_editor_'+b.name+'">'+'<span class="'+CKEDITOR.env.cssClass+'">'+'<span class="cke_wrapper cke_'+b.lang.dir+'">'+'<span class="cke_editor">'+'<div class="cke_'+c+'">'+'</div></span></span></span></span></span>',g=e.append(CKEDITOR.dom.element.createFromHtml(f,e.getDocument()));if(e.getCustomData('cke_hasshared'))g.hide();else e.setCustomData('cke_hasshared',1);d=g.getChild([0,0,0,0]);!b.sharedSpaces&&(b.sharedSpaces={});b.sharedSpaces[c]=d;b.on('focus',function(){for(var h=0,i,j=e.getChildren();i=j.getItem(h);h++){if(i.type==1&&!i.equals(g)&&i.hasClass('cke_shared'))i.hide();}g.show();});b.on('destroy',function(){g.remove();});}return d;};return{build:function(b,c){var d=b.name,e=b.element,f=b.elementMode;if(!e||f==0)return;if(f==1)e.hide();var g=b.fire('themeSpace',{space:'top',html:''}).html,h=b.fire('themeSpace',{space:'contents',html:''}).html,i=b.fireOnce('themeSpace',{space:'bottom',html:''}).html,j=h&&b.config.height,k=b.config.tabIndex||b.element.getAttribute('tabindex')||0;
if(!h)j='auto';else if(!isNaN(j))j+='px';var l='',m=b.config.width;if(m){if(!isNaN(m))m+='px';l+='width: '+m+';';}var n=g&&a(b,'top'),o=a(b,'bottom');n&&(n.setHtml(g),g='');o&&(o.setHtml(i),i='');var p=CKEDITOR.dom.element.createFromHtml(['<span id="cke_',d,'" class="',b.skinClass,' ',b.id,' cke_editor_',d,'" dir="',b.lang.dir,'" title="',CKEDITOR.env.gecko?' ':'','" lang="',b.langCode,'"'+(CKEDITOR.env.webkit?' tabindex="'+k+'"':'')+' role="application"'+' aria-labelledby="cke_',d,'_arialbl"'+(l?' style="'+l+'"':'')+'>'+'<span id="cke_',d,'_arialbl" class="cke_voice_label">'+b.lang.editor+'</span>'+'<span class="',CKEDITOR.env.cssClass,'" role="presentation"><span class="cke_editor" role="presentation" style="display:block"><span class="cke_',b.lang.dir,'" role="presentation"><span',g?'':' style="display:none"',' id="cke_top_',d,'" class="cke_top" role="presentation">',g,'</span>','</span></span><span class="cke_wrapper cke_',b.lang.dir,'" role="presentation"><table class="cke_editor" border="0" cellspacing="0" cellpadding="0" role="presentation"><tbody><tr',h?'':' style="display:none"',' role="presentation"><td id="cke_contents_',d,'" class="cke_contents" style="height:',j,'" role="presentation">',h,'</td></tr><tr',i?'':' style="display:none"',' role="presentation"><td id="cke_bottom_',d,'" class="cke_bottom" role="presentation">',i,'</td></tr></tbody></table><style>.',b.skinClass,'{visibility:hidden;}</style></span></span></span>'].join(''));p.getChild([1,0]).unselectable();p.getChild([1,1,0,0,1]).unselectable();if(f==1)p.insertAfter(e);else e.append(p);b.container=p;p.disableContextMenu();b.fireOnce('themeLoaded');b.fireOnce('uiReady');},buildDialog:function(b){var c=CKEDITOR.tools.getNextNumber(),d=CKEDITOR.dom.element.createFromHtml(['<div class="',b.id,'_dialog cke_editor_',b.name.replace('.','\\.'),'_dialog cke_skin_',b.skinName,'" dir="',b.lang.dir,'" lang="',b.langCode,'" role="dialog" aria-labelledby="%title#"><table class="cke_dialog',' '+CKEDITOR.env.cssClass,' cke_',b.lang.dir,'" style="position:absolute" role="presentation"><tr><td role="presentation"><div class="%body" role="presentation"><div id="%title#" class="%title" role="presentation"></div><a id="%close_button#" class="%close_button" href="javascript:void(0)" title="'+b.lang.common.close+'" role="button"><span class="cke_label">X</span></a>'+'<div id="%tabs#" class="%tabs" role="tablist"></div>'+'<table class="%contents" role="presentation">'+'<tr>'+'<td id="%contents#" class="%contents" role="presentation"></td>'+'</tr>'+'<tr>'+'<td id="%footer#" class="%footer" role="presentation"></td>'+'</tr>'+'</table>'+'</div>'+'<div id="%tl#" class="%tl"></div>'+'<div id="%tc#" class="%tc"></div>'+'<div id="%tr#" class="%tr"></div>'+'<div id="%ml#" class="%ml"></div>'+'<div id="%mr#" class="%mr"></div>'+'<div id="%bl#" class="%bl"></div>'+'<div id="%bc#" class="%bc"></div>'+'<div id="%br#" class="%br"></div>'+'</td></tr>'+'</table>',CKEDITOR.env.ie?'':'<style>.cke_dialog{visibility:hidden;}</style>','</div>'].join('').replace(/#/g,'_'+c).replace(/%/g,'cke_dialog_')),e=d.getChild([0,0,0,0,0]),f=e.getChild(0),g=e.getChild(1);
f.unselectable();g.unselectable();return{element:d,parts:{dialog:d.getChild(0),title:f,close:g,tabs:e.getChild(2),contents:e.getChild([3,0,0,0]),footer:e.getChild([3,0,1,0])}};},destroy:function(b){var c=b.container,d=b.element;if(c){c.clearCustomData();c.remove();}if(d){d.clearCustomData();b.elementMode==1&&d.show();delete b.element;}}};})());CKEDITOR.editor.prototype.lock=function(){if(this._.mask)return;var a=this.container,b=new CKEDITOR.dom.element('div',CKEDITOR.document);b.setStyles({position:'absolute',left:0,top:0,'z-index':99,opacity:0.5,'-ms-filter':'alpha(opacity=50)',filter:'alpha(opacity=50)','background-color':'#fff',cursor:'progress'});b.setStyle('width',a.$.offsetWidth+'px');b.setStyle('height',a.$.offsetHeight+'px');a.setStyle('position','relative');a.append(b);this._.mask=b;};CKEDITOR.editor.prototype.unlock=function(){var a=this;if(a._.mask){a._.mask.remove();a._.mask=null;a.focus();}};CKEDITOR.editor.prototype.getThemeSpace=function(a){var b='cke_'+a,c=this._[b]||(this._[b]=CKEDITOR.document.getById(b+'_'+this.name));return c;};CKEDITOR.editor.prototype.resize=function(a,b,c,d){var e=this.container,f=CKEDITOR.document.getById('cke_contents_'+this.name),g=d?e.getChild(1):e;if(a!==null){CKEDITOR.env.webkit&&g.setStyle('display','none');g.setSize('width',a,true);if(CKEDITOR.env.webkit){g.$.offsetWidth;g.setStyle('display','');}}if(b){var h=c?0:(g.$.offsetHeight||0)-(f.$.clientHeight||0);f.setStyle('height',Math.max(b-h,0)+'px');}this.fire('resize');};CKEDITOR.editor.prototype.getResizable=function(){return this.container;};})();
